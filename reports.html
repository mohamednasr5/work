<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>التقارير - نظام الحضور والانصراف</title>
    
    <!-- Bootstrap 5 Arabic -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap RTL -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-rtl@0.4.0/dist/css/bootstrap-rtl.min.css">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --success-color: #2ecc71;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
        }
        
        * {
            font-family: 'Cairo', sans-serif;
        }
        
        body {
            background-color: #f8f9fa;
        }
        
        .navbar {
            background: linear-gradient(135deg, var(--primary-color) 0%, #1a2530 100%);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
        }
        
        .navbar-brand {
            font-weight: 800;
            font-size: 1.6rem;
            background: linear-gradient(45deg, #fff, #3498db);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            margin-bottom: 30px;
        }
        
        .card-header {
            background: linear-gradient(90deg, #f8f9fa, #e9ecef);
            border-bottom: 2px solid #e9ecef;
            border-radius: 15px 15px 0 0 !important;
        }
        
        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }
        
        .report-card {
            text-align: center;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .report-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        
        .report-card i {
            font-size: 48px;
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="admin-dashboard.html">
                <i class="fas fa-chart-bar me-2"></i>
                التقارير والإحصائيات
            </a>
            
            <div class="d-flex align-items-center">
                <a href="admin-dashboard.html" class="btn btn-outline-light me-3">
                    <i class="fas fa-arrow-right me-2"></i>
                    العودة
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container-fluid mt-4">
        <div class="row">
            <div class="col-md-4 mb-4">
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-filter me-2"></i>
                        عوامل التصفية
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label class="form-label">الفترة الزمنية</label>
                            <select class="form-control" id="timePeriod">
                                <option value="today">اليوم</option>
                                <option value="week">هذا الأسبوع</option>
                                <option value="month" selected>هذا الشهر</option>
                                <option value="quarter">هذا الربع</option>
                                <option value="year">هذا العام</option>
                                <option value="custom">مخصص</option>
                            </select>
                        </div>
                        
                        <div id="customDateRange" style="display: none;">
                            <div class="mb-3">
                                <label class="form-label">من تاريخ</label>
                                <input type="date" class="form-control" id="dateFrom">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">إلى تاريخ</label>
                                <input type="date" class="form-control" id="dateTo">
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">القسم</label>
                            <select class="form-control" id="department">
                                <option value="">جميع الأقسام</option>
                                <option value="it">تقنية المعلومات</option>
                                <option value="hr">الموارد البشرية</option>
                                <option value="sales">المبيعات</option>
                                <option value="marketing">التسويق</option>
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">نوع التقرير</label>
                            <select class="form-control" id="reportType">
                                <option value="attendance">الحضور والانصراف</option>
                                <option value="hours">ساعات العمل</option>
                                <option value="late">التأخيرات</option>
                                <option value="absent">الغياب</option>
                            </select>
                        </div>
                        
                        <button class="btn btn-primary w-100" id="generateReportBtn">
                            <i class="fas fa-chart-line me-2"></i>
                            إنشاء التقرير
                        </button>
                    </div>
                </div>
                
                <div class="report-card bg-primary text-white">
                    <i class="fas fa-file-excel"></i>
                    <h5>تصدير إلى Excel</h5>
                    <p>تحميل التقرير بصيغة Excel</p>
                    <button class="btn btn-light" id="exportExcelBtn">
                        <i class="fas fa-download me-2"></i>
                        تحميل
                    </button>
                </div>
                
                <div class="report-card bg-success text-white">
                    <i class="fas fa-file-pdf"></i>
                    <h5>تصدير إلى PDF</h5>
                    <p>تحميل التقرير بصيغة PDF</p>
                    <button class="btn btn-light" id="exportPdfBtn">
                        <i class="fas fa-download me-2"></i>
                        تحميل
                    </button>
                </div>
            </div>
            
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <div>
                            <i class="fas fa-chart-bar me-2"></i>
                            التقرير المالي
                        </div>
                        <div>
                            <button class="btn btn-sm btn-outline-primary me-2" id="printReportBtn">
                                <i class="fas fa-print"></i>
                            </button>
                            <button class="btn btn-sm btn-primary" id="refreshReportBtn">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <h5 class="text-center mb-4" id="reportTitle">تقرير الحضور الشهري</h5>
                        
                        <div class="chart-container mb-4">
                            <canvas id="mainChart"></canvas>
                        </div>
                        
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>الموظف</th>
                                        <th>أيام الحضور</th>
                                        <th>أيام الغياب</th>
                                        <th>التأخيرات</th>
                                        <th>إجمالي الساعات</th>
                                        <th>متوسط الحضور</th>
                                    </tr>
                                </thead>
                                <tbody id="reportTableBody">
                                    <tr>
                                        <td colspan="6" class="text-center text-muted">
                                            اختر عوامل التصفية ثم اضغط على "إنشاء التقرير"
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <i class="fas fa-chart-pie me-2"></i>
                                توزيع الحضور
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <canvas id="pieChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <i class="fas fa-trend-up me-2"></i>
                                الاتجاهات
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <canvas id="trendChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <script>
        // Initialize Charts
        let mainChart, pieChart, trendChart;
        
        function initializeCharts() {
            // Main Chart
            const mainCtx = document.getElementById('mainChart');
            if (mainCtx) {
                mainChart = new Chart(mainCtx, {
                    type: 'bar',
                    data: {
                        labels: ['الأسبوع 1', 'الأسبوع 2', 'الأسبوع 3', 'الأسبوع 4'],
                        datasets: [{
                            label: 'نسبة الحضور',
                            data: [85, 90, 88, 92],
                            backgroundColor: 'rgba(52, 152, 219, 0.7)',
                            borderColor: 'rgba(52, 152, 219, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100
                            }
                        }
                    }
                });
            }
            
            // Pie Chart
            const pieCtx = document.getElementById('pieChart');
            if (pieCtx) {
                pieChart = new Chart(pieCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['حاضر', 'غائب', 'متأخر', 'إجازة'],
                        datasets: [{
                            data: [70, 10, 15, 5],
                            backgroundColor: [
                                'rgba(46, 204, 113, 0.7)',
                                'rgba(231, 76, 60, 0.7)',
                                'rgba(243, 156, 18, 0.7)',
                                'rgba(52, 152, 219, 0.7)'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false
                    }
                });
            }
            
            // Trend Chart
            const trendCtx = document.getElementById('trendChart');
            if (trendCtx) {
                trendChart = new Chart(trendCtx, {
                    type: 'line',
                    data: {
                        labels: ['يناير', 'فبراير', 'مارس', 'أبريل', 'مايو', 'يونيو'],
                        datasets: [{
                            label: 'نسبة الحضور',
                            data: [85, 88, 90, 87, 92, 94],
                            borderColor: 'rgba(46, 204, 113, 1)',
                            backgroundColor: 'rgba(46, 204, 113, 0.1)',
                            tension: 0.4,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: false,
                                min: 80
                            }
                        }
                    }
                });
            }
        }
        
        // Generate Report
        document.getElementById('generateReportBtn').addEventListener('click', function() {
            const timePeriod = document.getElementById('timePeriod').value;
            const reportType = document.getElementById('reportType').value;
            
            // Show loading
            const tbody = document.getElementById('reportTableBody');
            tbody.innerHTML = `
                <tr>
                    <td colspan="6" class="text-center">
                        <i class="fas fa-spinner fa-spin"></i> جاري إنشاء التقرير...
                    </td>
                </tr>
            `;
            
            // Update report title
            const titles = {
                'attendance': 'تقرير الحضور والانصراف',
                'hours': 'تقرير ساعات العمل',
                'late': 'تقرير التأخيرات',
                'absent': 'تقرير الغياب'
            };
            
            document.getElementById('reportTitle').textContent = titles[reportType] + ' - ' + 
                (timePeriod === 'today' ? 'اليوم' : 
                 timePeriod === 'week' ? 'هذا الأسبوع' :
                 timePeriod === 'month' ? 'هذا الشهر' :
                 timePeriod === 'quarter' ? 'هذا الربع' :
                 timePeriod === 'year' ? 'هذا العام' : 'مخصص');
            
            // Simulate data loading
            setTimeout(() => {
                tbody.innerHTML = `
                    <tr>
                        <td>أحمد محمد</td>
                        <td>22</td>
                        <td>0</td>
                        <td>2</td>
                        <td>176</td>
                        <td>98%</td>
                    </tr>
                    <tr>
                        <td>سارة عبدالله</td>
                        <td>21</td>
                        <td>1</td>
                        <td>1</td>
                        <td>168</td>
                        <td>95%</td>
                    </tr>
                    <tr>
                        <td>خالد سعود</td>
                        <td>20</td>
                        <td>2</td>
                        <td>4</td>
                        <td>160</td>
                        <td>91%</td>
                    </tr>
                    <tr>
                        <td>نورة القحطاني</td>
                        <td>22</td>
                        <td>0</td>
                        <td>0</td>
                        <td>176</td>
                        <td>100%</td>
                    </tr>
                    <tr>
                        <td>محمد العتيبي</td>
                        <td>19</td>
                        <td>3</td>
                        <td>5</td>
                        <td>152</td>
                        <td>86%</td>
                    </tr>
                `;
                
                // Update charts with new data
                if (mainChart) {
                    mainChart.data.datasets[0].data = [88, 92, 85, 90];
                    mainChart.update();
                }
                
                if (pieChart) {
                    pieChart.data.datasets[0].data = [22, 2, 4, 0];
                    pieChart.update();
                }
                
                showNotification('تم إنشاء التقرير بنجاح', 'success');
            }, 1500);
        });
        
        // Show/Hide custom date range
        document.getElementById('timePeriod').addEventListener('change', function() {
            const customRange = document.getElementById('customDateRange');
            customRange.style.display = this.value === 'custom' ? 'block' : 'none';
        });
        
        // Export to Excel
        document.getElementById('exportExcelBtn').addEventListener('click', function() {
            showNotification('جاري تحضير ملف Excel للتحميل...', 'info');
            // In real app, generate Excel file
            setTimeout(() => {
                showNotification('تم تحضير الملف للتحميل', 'success');
                // Trigger download
                const link = document.createElement('a');
                link.href = '#';
                link.download = 'تقرير_الحضور.xlsx';
                link.click();
            }, 2000);
        });
        
        // Export to PDF
        document.getElementById('exportPdfBtn').addEventListener('click', function() {
            showNotification('جاري تحضير ملف PDF للتحميل...', 'info');
            // In real app, generate PDF file
            setTimeout(() => {
                showNotification('تم تحضير الملف للتحميل', 'success');
                // Trigger download
                const link = document.createElement('a');
                link.href = '#';
                link.download = 'تقرير_الحضور.pdf';
                link.click();
            }, 2000);
        });
        
        // Print Report
        document.getElementById('printReportBtn').addEventListener('click', function() {
            window.print();
        });
        
        // Refresh Report
        document.getElementById('refreshReportBtn').addEventListener('click', function() {
            document.getElementById('generateReportBtn').click();
        });
        
        // Show Notification
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `alert alert-${type} alert-dismissible fade show position-fixed`;
            notification.style.cssText = 'top: 20px; left: 20px; z-index: 9999; min-width: 300px;';
            notification.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 5000);
        }
        
        // Check if user is admin
        function checkUserSession() {
            const userData = localStorage.getItem('currentUser');
            
            if (!userData) {
                window.location.href = 'index.html';
                return false;
            }
            
            const user = JSON.parse(userData);
            
            if (user.role !== 'admin') {
                window.location.href = 'employee-dashboard.html';
                return false;
            }
            
            return true;
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            if (!checkUserSession()) return;
            
            initializeCharts();
            
            // Set default dates
            const today = new Date();
            const firstDay = new Date(today.getFullYear(), today.getMonth(), 1);
            
            document.getElementById('dateFrom').value = firstDay.toISOString().split('T')[0];
            document.getElementById('dateTo').value = today.toISOString().split('T')[0];
        });
    </script>
</body>
</html>
