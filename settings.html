<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>الإعدادات - نظام الحضور والانصراف</title>
    
    <!-- Bootstrap 5 Arabic -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap RTL -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-rtl@0.4.0/dist/css/bootstrap-rtl.min.css">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --success-color: #2ecc71;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
        }
        
        * {
            font-family: 'Cairo', sans-serif;
        }
        
        body {
            background-color: #f8f9fa;
        }
        
        .navbar {
            background: linear-gradient(135deg, var(--primary-color) 0%, #1a2530 100%);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
        }
        
        .navbar-brand {
            font-weight: 800;
            font-size: 1.6rem;
            background: linear-gradient(45deg, #fff, #3498db);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            margin-bottom: 25px;
        }
        
        .card-header {
            background: linear-gradient(90deg, #f8f9fa, #e9ecef);
            border-bottom: 2px solid #e9ecef;
            border-radius: 15px 15px 0 0 !important;
            font-weight: 700;
            color: var(--primary-color);
        }
        
        .setting-item {
            padding: 15px 0;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .setting-item:last-child {
            border-bottom: none;
        }
        
        .setting-label {
            font-weight: 600;
            color: #2c3e50;
        }
        
        .setting-description {
            color: #7f8c8d;
            font-size: 0.9rem;
            margin-top: 5px;
        }
        
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .toggle-slider {
            background-color: #2196F3;
        }
        
        input:checked + .toggle-slider:before {
            transform: translateX(30px);
        }
        
        .color-picker {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            border: 2px solid #ddd;
            cursor: pointer;
        }
        
        .danger-zone {
            border: 2px solid #e74c3c;
            border-radius: 15px;
            padding: 20px;
            background: rgba(231, 76, 60, 0.05);
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="admin-dashboard.html">
                <i class="fas fa-cogs me-2"></i>
                إعدادات النظام
            </a>
            
            <div class="d-flex align-items-center">
                <a href="admin-dashboard.html" class="btn btn-outline-light me-3">
                    <i class="fas fa-arrow-right me-2"></i>
                    العودة
                </a>
            </div>
        </div>
    </nav>
    
    <div class="container-fluid mt-4">
        <div class="row">
            <div class="col-lg-3 mb-4">
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-bars me-2"></i>
                        قائمة الإعدادات
                    </div>
                    <div class="list-group list-group-flush">
                        <a href="#generalSettings" class="list-group-item list-group-item-action active" data-bs-toggle="list">
                            <i class="fas fa-cog me-2"></i>
                            الإعدادات العامة
                        </a>
                        <a href="#attendanceSettings" class="list-group-item list-group-item-action" data-bs-toggle="list">
                            <i class="fas fa-clock me-2"></i>
                            إعدادات الحضور
                        </a>
                        <a href="#notificationSettings" class="list-group-item list-group-item-action" data-bs-toggle="list">
                            <i class="fas fa-bell me-2"></i>
                            إعدادات الإشعارات
                        </a>
                        <a href="#locationSettings" class="list-group-item list-group-item-action" data-bs-toggle="list">
                            <i class="fas fa-map-marker-alt me-2"></i>
                            إعدادات الموقع
                        </a>
                        <a href="#securitySettings" class="list-group-item list-group-item-action" data-bs-toggle="list">
                            <i class="fas fa-shield-alt me-2"></i>
                            الأمان
                        </a>
                        <a href="#backupSettings" class="list-group-item list-group-item-action" data-bs-toggle="list">
                            <i class="fas fa-database me-2"></i>
                            النسخ الاحتياطي
                        </a>
                        <a href="#advancedSettings" class="list-group-item list-group-item-action" data-bs-toggle="list">
                            <i class="fas fa-sliders-h me-2"></i>
                            إعدادات متقدمة
                        </a>
                    </div>
                </div>
                
                <div class="card mt-4">
                    <div class="card-body text-center">
                        <button class="btn btn-primary w-100 mb-2" id="saveAllSettings">
                            <i class="fas fa-save me-2"></i>
                            حفظ جميع الإعدادات
                        </button>
                        <button class="btn btn-outline-secondary w-100" id="resetSettings">
                            <i class="fas fa-undo me-2"></i>
                            استعادة الإفتراضيات
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="col-lg-9">
                <div class="tab-content">
                    <!-- General Settings -->
                    <div class="tab-pane fade show active" id="generalSettings">
                        <div class="card">
                            <div class="card-header">
                                <i class="fas fa-cog me-2"></i>
                                الإعدادات العامة
                            </div>
                            <div class="card-body">
                                <div class="setting-item">
                                    <div>
                                        <div class="setting-label">اسم المؤسسة</div>
                                        <div class="setting-description">الاسم الذي سيظهر في النظام</div>
                                    </div>
                                    <input type="text" class="form-control" id="companyName" style="width: 300px;" value="شركة التقنية المبتكرة">
                                </div>
                                
                                <div class="setting-item">
                                    <div>
                                        <div class="setting-label">شعار المؤسسة</div>
                                        <div class="setting-description">تحميل شعار المؤسسة</div>
                                    </div>
                                    <div>
                                        <input type="file" class="form-control" id="companyLogo" accept="image/*" style="width: 300px;">
                                        <small class="text-muted">الحجم المسموح: 2MB، الصيغ: JPG, PNG</small>
                                    </div>
                                </div>
                                
                                <div class="setting-item">
                                    <div>
                                        <div class="setting-label">اللغة الافتراضية</div>
                                        <div class="setting-description">لغة واجهة النظام</div>
                                    </div>
                                    <select class="form-control" id="defaultLanguage" style="width: 300px;">
                                        <option value="ar" selected>العربية</option>
                                        <option value="en">English</option>
                                    </select>
                                </div>
                                
                                <div class="setting-item">
                                    <div>
                                        <div class="setting-label">المنطقة الزمنية</div>
                                        <div class="setting-description">المنطقة الزمنية للنظام</div>
                                    </div>
                                    <select class="form-control" id="timezone" style="width: 300px;">
                                        <option value="Asia/Riyadh" selected>الرياض (ت ع م+03:00)</option>
                                        <option value="Asia/Dubai">دبي (ت ع م+04:00)</option>
                                        <option value="Asia/Kuwait">الكويت (ت ع م+03:00)</option>
                                    </select>
                                </div>
                                
                                <div class="setting-item">
                                    <div>
                                        <div class="setting-label">تنسيق التاريخ</div>
                                        <div class="setting-description">كيفية عرض التواريخ</div>
                                    </div>
                                    <select class="form-control" id="dateFormat" style="width: 300px;">
                                        <option value="dd/MM/yyyy" selected>يوم/شهر/سنة</option>
                                        <option value="MM/dd/yyyy">شهر/يوم/سنة</option>
                                        <option value="yyyy-MM-dd">سنة-شهر-يوم</option>
                                    </select>
                                </div>
                                
                                <div class="setting-item">
                                    <div>
                                        <div class="setting-label">لون السمة الرئيسية</div>
                                        <div class="setting-description">اختيار اللون الرئيسي للنظام</div>
                                    </div>
                                    <input type="color" class="color-picker" id="primaryColor" value="#2c3e50">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Attendance Settings -->
                    <div class="tab-pane fade" id="attendanceSettings">
                        <div class="card">
                            <div class="card-header">
                                <i class="fas fa-clock me-2"></i>
                                إعدادات الحضور والانصراف
                            </div>
                            <div class="card-body">
                                <div class="setting-item">
                                    <div>
                                        <div class="setting-label">وقت بداية الدوام</div>
                                        <div class="setting-description">الوقت الرسمي لبداية الدوام</div>
                                    </div>
                                    <input type="time" class="form-control" id="workStartTime" style="width: 200px;" value="08:00">
                                </div>
                                
                                <div class="setting-item">
                                    <div>
                                        <div class="setting-label">وقت نهاية الدوام</div>
                                        <div class="setting-description">الوقت الرسمي لنهاية الدوام</div>
                                    </div>
                                    <input type="time" class="form-control" id="workEndTime" style="width: 200px;" value="17:00">
                                </div>
                                
                                <div class="setting-item">
                                    <div>
                                        <div class="setting-label">وقت التسجيل المسموح</div>
                                        <div class="setting-description">الوقت المسموح للتسجيل قبل/بعد الدوام</div>
                                    </div>
                                    <div class="d-flex align-items-center" style="gap: 10px;">
                                        <input type="number" class="form-control" id="checkInBuffer" style="width: 100px;" value="30" min="0">
                                        <span>دقيقة قبل وبعد الدوام</span>
                                    </div>
                                </div>
                                
                                <div class="setting-item">
                                    <div>
                                        <div class="setting-label">تسجيل الدخول المتأخر</div>
                                        <div class="setting-description">اعتبار الموظف متأخراً إذا دخل بعد</div>
                                    </div>
                                    <div class="d-flex align-items-center" style="gap: 10px;">
                                        <input type="number" class="form-control" id="lateThreshold" style="width: 100px;" value="15" min="0">
                                        <span>دقيقة من بداية الدوام</span>
                                    </div>
                                </div>
                                
                                <div class="setting-item">
                                    <div>
                                        <div class="setting-label">نظام العمل الأسبوعي</div>
                                        <div class="setting-description">أيام العمل في الأسبوع</div>
                                    </div>
                                    <div class="d-flex flex-wrap" style="gap: 10px;">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="sunday" checked>
                                            <label class="form-check-label" for="sunday">الأحد</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="monday" checked>
                                            <label class="form-check-label" for="monday">الاثنين</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="tuesday" checked>
                                            <label class="form-check-label" for="tuesday">الثلاثاء</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="wednesday" checked>
                                            <label class="form-check-label" for="wednesday">الأربعاء</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="thursday" checked>
                                            <label class="form-check-label" for="thursday">الخميس</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="friday">
                                            <label class="form-check-label" for="friday">الجمعة</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" id="saturday">
                                            <label class="form-check-label" for="saturday">السبت</label>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="setting-item">
                                    <div>
                                        <div class="setting-label">تفعيل التحقق من الموقع</div>
                                        <div class="setting-description">التأكد من وجود الموظف في موقع العمل</div>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="enableLocationCheck" checked>
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                                
                                <div class="setting-item">
                                    <div>
                                        <div class="setting-label">نطاق التسجيل (متر)</div>
                                        <div class="setting-description">المسافة المسموحة من موقع العمل</div>
                                    </div>
                                    <div class="d-flex align-items-center" style="gap: 10px;">
                                        <input type="range" class="form-range" id="attendanceRadius" min="10" max="500" value="100" style="width: 200px;">
                                        <span id="radiusValue">100 متر</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Notification Settings -->
                    <div class="tab-pane fade" id="notificationSettings">
                        <div class="card">
                            <div class="card-header">
                                <i class="fas fa-bell me-2"></i>
                                إعدادات الإشعارات
                            </div>
                            <div class="card-body">
                                <div class="setting-item">
                                    <div>
                                        <div class="setting-label">تفعيل الإشعارات</div>
                                        <div class="setting-description">تفعيل جميع إشعارات النظام</div>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="enableAllNotifications" checked>
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                                
                                <div class="setting-item">
                                    <div>
                                        <div class="setting-label">إشعارات الحضور</div>
                                        <div class="setting-description">إشعارات دخول وخروج الموظفين</div>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="enableAttendanceNotifications" checked>
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                                
                                <div class="setting-item">
                                    <div>
                                        <div class="setting-label">إشعارات التأخير</div>
                                        <div class="setting-description">إشعارات عند تأخر الموظفين</div>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="enableLateNotifications" checked>
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                                
                                <div class="setting-item">
                                    <div>
                                        <div class="setting-label">إشعارات الغياب</div>
                                        <div class="setting-description">إشعارات عند غياب الموظفين</div>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="enableAbsentNotifications" checked>
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                                
                                <div class="setting-item">
                                    <div>
                                        <div class="setting-label">إشعارات البريد الإلكتروني</div>
                                        <div class="setting-description">إرسال الإشعارات عبر البريد الإلكتروني</div>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="enableEmailNotifications" checked>
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                                
                                <div class="setting-item">
                                    <div>
                                        <div class="setting-label">إشعارات الجوال</div>
                                        <div class="setting-description">إرسال الإشعارات عبر تطبيق الجوال</div>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="enablePushNotifications">
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                                
                                <div class="setting-item">
                                    <div>
                                        <div class="setting-label">وقت إرسال التقارير اليومية</div>
                                        <div class="setting-description">الوقت اليومي لإرسال تقرير الحضور</div>
                                    </div>
                                    <input type="time" class="form-control" id="dailyReportTime" style="width: 200px;" value="18:00">
                                </div>
                                
                                <div class="setting-item">
                                    <div>
                                        <div class="setting-label">البريد الإلكتروني للإشعارات</div>
                                        <div class="setting-description">البريد الإلكتروني الرئيسي للإشعارات</div>
                                    </div>
                                    <input type="email" class="form-control" id="notificationEmail" style="width: 300px;" value="admin@company.com">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Location Settings -->
                    <div class="tab-pane fade" id="locationSettings">
                        <div class="card">
                            <div class="card-header">
                                <i class="fas fa-map-marker-alt me-2"></i>
                                إعدادات الموقع الجغرافي
                            </div>
                            <div class="card-body">
                                <div class="setting-item">
                                    <div>
                                        <div class="setting-label">موقع العمل الرئيسي</div>
                                        <div class="setting-description">الإحداثيات الجغرافية لموقع العمل</div>
                                    </div>
                                    <div>
                                        <div class="row g-2 mb-2">
                                            <div class="col">
                                                <input type="text" class="form-control" id="locationLat" placeholder="خط العرض" value="24.7136">
                                            </div>
                                            <div class="col">
                                                <input type="text" class="form-control" id="locationLng" placeholder="خط الطول" value="46.6753">
                                            </div>
                                        </div>
                                        <small class="text-muted">إحداثيات الموقع: الرياض، المملكة العربية السعودية</small>
                                    </div>
                                </div>
                                
                                <div class="setting-item">
                                    <div>
                                        <div class="setting-label">عنوان موقع العمل</div>
                                        <div class="setting-description">العنوان الوصفي لموقع العمل</div>
                                    </div>
                                    <textarea class="form-control" id="workAddress" style="width: 300px;" rows="3">الرياض - حي العليا - طريق الملك فهد</textarea>
                                </div>
                                
                                <div class="setting-item">
                                    <div>
                                        <div class="setting-label">دقة GPS المطلوبة</div>
                                        <div class="setting-description">الدقة المطلوبة في تحديد الموقع</div>
                                    </div>
                                    <select class="form-control" id="gpsAccuracy" style="width: 200px;">
                                        <option value="high">عالية (10 أمتار)</option>
                                        <option value="medium" selected>متوسطة (30 متر)</option>
                                        <option value="low">منخفضة (100 متر)</option>
                                    </select>
                                </div>
                                
                                <div class="setting-item">
                                    <div>
                                        <div class="setting-label">تحديث الموقع التلقائي</div>
                                        <div class="setting-description">فترة تحديث الموقع التلقائي</div>
                                    </div>
                                    <select class="form-control" id="locationUpdateInterval" style="width: 200px;">
                                        <option value="5">كل 5 ثواني</option>
                                        <option value="10">كل 10 ثواني</option>
                                        <option value="30" selected>كل 30 ثانية</option>
                                        <option value="60">كل دقيقة</option>
                                        <option value="300">كل 5 دقائق</option>
                                    </select>
                                </div>
                                
                                <div class="setting-item">
                                    <div>
                                        <div class="setting-label">مواقع فرعية</div>
                                        <div class="setting-description">إضافة مواقع فرعية للحضور</div>
                                    </div>
                                    <button class="btn btn-outline-primary" id="addBranchLocation">
                                        <i class="fas fa-plus me-2"></i>
                                        إضافة موقع فرعي
                                    </button>
                                </div>
                                
                                <div id="branchLocations" class="mt-3">
                                    <!-- سيتم إضافة المواقع الفرعية هنا -->
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Security Settings -->
                    <div class="tab-pane fade" id="securitySettings">
                        <div class="card">
                            <div class="card-header">
                                <i class="fas fa-shield-alt me-2"></i>
                                إعدادات الأمان
                            </div>
                            <div class="card-body">
                                <div class="setting-item">
                                    <div>
                                        <div class="setting-label">قوة كلمة المرور</div>
                                        <div class="setting-description">متطلبات قوة كلمة المرور</div>
                                    </div>
                                    <select class="form-control" id="passwordStrength" style="width: 200px;">
                                        <option value="low">ضعيفة (6 أحرف)</option>
                                        <option value="medium" selected>متوسطة (8 أحرف + أرقام)</option>
                                        <option value="high">قوية (10 أحرف + أرقام + رموز)</option>
                                    </select>
                                </div>
                                
                                <div class="setting-item">
                                    <div>
                                        <div class="setting-label">مدة صلاحية كلمة المرور</div>
                                        <div class="setting-description">عدد الأيام قبل انتهاء صلاحية كلمة المرور</div>
                                    </div>
                                    <div class="d-flex align-items-center" style="gap: 10px;">
                                        <input type="number" class="form-control" id="passwordExpiry" style="width: 100px;" value="90" min="30">
                                        <span>يوم</span>
                                    </div>
                                </div>
                                
                                <div class="setting-item">
                                    <div>
                                        <div class="setting-label">المحاولات المسموحة</div>
                                        <div class="setting-description">عدد محاولات الدخول الخاطئة قبل القفل</div>
                                    </div>
                                    <div class="d-flex align-items-center" style="gap: 10px;">
                                        <input type="number" class="form-control" id="maxLoginAttempts" style="width: 100px;" value="5" min="1" max="10">
                                        <span>محاولة</span>
                                    </div>
                                </div>
                                
                                <div class="setting-item">
                                    <div>
                                        <div class="setting-label">مدة قفل الحساب</div>
                                        <div class="setting-description">مدة قفل الحساب بعد محاولات خاطئة</div>
                                    </div>
                                    <select class="form-control" id="lockoutDuration" style="width: 200px;">
                                        <option value="5">5 دقائق</option>
                                        <option value="15" selected>15 دقيقة</option>
                                        <option value="30">30 دقيقة</option>
                                        <option value="60">ساعة واحدة</option>
                                        <option value="1440">24 ساعة</option>
                                    </select>
                                </div>
                                
                                <div class="setting-item">
                                    <div>
                                        <div class="setting-label">جلسات متعددة</div>
                                        <div class="setting-description">السماح بتسجيل الدخول من أجهزة متعددة</div>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="allowMultipleSessions">
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                                
                                <div class="setting-item">
                                    <div>
                                        <div class="setting-label">مصادقة ثنائية</div>
                                        <div class="setting-description">تفعيل المصادقة الثنائية (2FA)</div>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="enable2FA">
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                                
                                <div class="setting-item">
                                    <div>
                                        <div class="setting-label">تسجيل النشاط</div>
                                        <div class="setting-description">تسجيل جميع نشاطات المستخدمين</div>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="enableActivityLog" checked>
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                                
                                <div class="setting-item">
                                    <div>
                                        <div class="setting-label">مدة الاحتفاظ بالسجلات</div>
                                        <div class="setting-description">عدد الأيام للاحتفاظ بسجلات النشاط</div>
                                    </div>
                                    <div class="d-flex align-items-center" style="gap: 10px;">
                                        <input type="number" class="form-control" id="logRetention" style="width: 100px;" value="365" min="30">
                                        <span>يوم</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Backup Settings -->
                    <div class="tab-pane fade" id="backupSettings">
                        <div class="card">
                            <div class="card-header">
                                <i class="fas fa-database me-2"></i>
                                النسخ الاحتياطي والاستعادة
                            </div>
                            <div class="card-body">
                                <div class="setting-item">
                                    <div>
                                        <div class="setting-label">النسخ الاحتياطي التلقائي</div>
                                        <div class="setting-description">تفعيل النسخ الاحتياطي التلقائي</div>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="enableAutoBackup" checked>
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                                
                                <div class="setting-item">
                                    <div>
                                        <div class="setting-label">توقيت النسخ الاحتياطي</div>
                                        <div class="setting-description">الوقت اليومي للنسخ الاحتياطي</div>
                                    </div>
                                    <input type="time" class="form-control" id="backupTime" style="width: 200px;" value="02:00">
                                </div>
                                
                                <div class="setting-item">
                                    <div>
                                        <div class="setting-label">تكرر النسخ الاحتياطي</div>
                                        <div class="setting-description">عدد مرات النسخ الاحتياطي أسبوعياً</div>
                                    </div>
                                    <select class="form-control" id="backupFrequency" style="width: 200px;">
                                        <option value="daily">يومياً</option>
                                        <option value="weekly" selected>أسبوعياً</option>
                                        <option value="monthly">شهرياً</option>
                                    </select>
                                </div>
                                
                                <div class="setting-item">
                                    <div>
                                        <div class="setting-label">عدد النسخ المحفوظة</div>
                                        <div class="setting-description">عدد النسخ الاحتياطية المحفوظة</div>
                                    </div>
                                    <div class="d-flex align-items-center" style="gap: 10px;">
                                        <input type="number" class="form-control" id="backupCount" style="width: 100px;" value="10" min="1" max="100">
                                        <span>نسخة</span>
                                    </div>
                                </div>
                                
                                <div class="setting-item">
                                    <div>
                                        <div class="setting-label">مكان حفظ النسخ</div>
                                        <div class="setting-description">مكان حفظ ملفات النسخ الاحتياطي</div>
                                    </div>
                                    <select class="form-control" id="backupLocation" style="width: 200px;">
                                        <option value="local" selected>الخادم المحلي</option>
                                        <option value="google_drive">Google Drive</option>
                                        <option value="dropbox">Dropbox</option>
                                        <option value="ftp">خادم FTP</option>
                                    </select>
                                </div>
                                
                                <div class="row mt-4">
                                    <div class="col-md-6">
                                        <div class="card">
                                            <div class="card-body text-center">
                                                <i class="fas fa-download fa-3x text-primary mb-3"></i>
                                                <h5>إنشاء نسخة احتياطية</h5>
                                                <p class="text-muted">إنشاء نسخة احتياطية يدوية</p>
                                                <button class="btn btn-primary" id="createBackupBtn">
                                                    <i class="fas fa-plus-circle me-2"></i>
                                                    إنشاء نسخة الآن
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="col-md-6">
                                        <div class="card">
                                            <div class="card-body text-center">
                                                <i class="fas fa-upload fa-3x text-success mb-3"></i>
                                                <h5>استعادة نسخة</h5>
                                                <p class="text-muted">استعادة البيانات من نسخة احتياطية</p>
                                                <input type="file" class="form-control mb-2" id="restoreFile" accept=".json,.sql,.backup">
                                                <button class="btn btn-success" id="restoreBackupBtn">
                                                    <i class="fas fa-history me-2"></i>
                                                    استعادة الآن
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="card mt-4">
                                    <div class="card-header">
                                        <i class="fas fa-history me-2"></i>
                                        النسخ الاحتياطية السابقة
                                    </div>
                                    <div class="card-body">
                                        <div class="table-responsive">
                                            <table class="table table-hover">
                                                <thead>
                                                    <tr>
                                                        <th>التاريخ</th>
                                                        <th>الحجم</th>
                                                        <th>النوع</th>
                                                        <th>الحالة</th>
                                                        <th>الإجراءات</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="backupHistory">
                                                    <tr>
                                                        <td>2024-01-14 02:00</td>
                                                        <td>2.4 MB</td>
                                                        <td>تلقائي</td>
                                                        <td><span class="badge bg-success">ناجح</span></td>
                                                        <td>
                                                            <button class="btn btn-sm btn-outline-primary">
                                                                <i class="fas fa-download"></i>
                                                            </button>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td>2024-01-13 02:00</td>
                                                        <td>2.3 MB</td>
                                                        <td>تلقائي</td>
                                                        <td><span class="badge bg-success">ناجح</span></td>
                                                        <td>
                                                            <button class="btn btn-sm btn-outline-primary">
                                                                <i class="fas fa-download"></i>
                                                            </button>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Advanced Settings -->
                    <div class="tab-pane fade" id="advancedSettings">
                        <div class="card">
                            <div class="card-header">
                                <i class="fas fa-sliders-h me-2"></i>
                                إعدادات متقدمة
                            </div>
                            <div class="card-body">
                                <div class="setting-item">
                                    <div>
                                        <div class="setting-label">وضع التصحيح</div>
                                        <div class="setting-description">تفعيل وضع التصحيح للأخطاء</div>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="debugMode">
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                                
                                <div class="setting-item">
                                    <div>
                                        <div class="setting-label">وضع الصيانة</div>
                                        <div class="setting-description">إيقاف النظام للصيانة</div>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="maintenanceMode">
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                                
                                <div class="setting-item">
                                    <div>
                                        <div class="setting-label">رسالة الصيانة</div>
                                        <div class="setting-description">الرسالة التي تظهر في وضع الصيانة</div>
                                    </div>
                                    <textarea class="form-control" id="maintenanceMessage" style="width: 300px;" rows="3">النظام قيد الصيانة. سنعود قريباً.</textarea>
                                </div>
                                
                                <div class="setting-item">
                                    <div>
                                        <div class="setting-label">مهلة الاتصال</div>
                                        <div class="setting-description">مهلة انتظار الاتصال بالخادم (ثانية)</div>
                                    </div>
                                    <div class="d-flex align-items-center" style="gap: 10px;">
                                        <input type="number" class="form-control" id="connectionTimeout" style="width: 100px;" value="30" min="5" max="120">
                                        <span>ثانية</span>
                                    </div>
                                </div>
                                
                                <div class="setting-item">
                                    <div>
                                        <div class="setting-label">الذاكرة المؤقتة</div>
                                        <div class="setting-description">تفعيل الذاكرة المؤقتة للأداء</div>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="enableCache" checked>
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                                
                                <div class="setting-item">
                                    <div>
                                        <div class="setting-label">مدة الذاكرة المؤقتة</div>
                                        <div class="setting-description">مدة حفظ البيانات في الذاكرة المؤقتة</div>
                                    </div>
                                    <div class="d-flex align-items-center" style="gap: 10px;">
                                        <input type="number" class="form-control" id="cacheDuration" style="width: 100px;" value="300" min="60" max="3600">
                                        <span>ثانية</span>
                                    </div>
                                </div>
                                
                                <div class="danger-zone mt-5">
                                    <h5 class="text-danger">
                                        <i class="fas fa-exclamation-triangle me-2"></i>
                                        منطقة الخطر
                                    </h5>
                                    <p class="text-muted mb-4">هذه الإعدادات قد تؤثر على استقرار النظام. استخدمها بحذر.</p>
                                    
                                    <div class="row">
                                        <div class="col-md-4 mb-3">
                                            <button class="btn btn-outline-danger w-100" id="clearCacheBtn">
                                                <i class="fas fa-broom me-2"></i>
                                                مسح الذاكرة المؤقتة
                                            </button>
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <button class="btn btn-outline-danger w-100" id="clearLogsBtn">
                                                <i class="fas fa-trash-alt me-2"></i>
                                                مسح سجلات النظام
                                            </button>
                                        </div>
                                        <div class="col-md-4 mb-3">
                                            <button class="btn btn-outline-danger w-100" id="resetDatabaseBtn">
                                                <i class="fas fa-database me-2"></i>
                                                إعادة تعيين البيانات
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    
    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyC4J8ncbuejvzfWvzCTAXRzjFgvrchXpE",
            authDomain: "hedor-bea3c.firebaseapp.com",
            databaseURL: "https://hedor-bea3c-default-rtdb.firebaseio.com",
            projectId: "hedor-bea3c",
            storageBucket: "hedor-bea3c.firebasestorage.app",
            messagingSenderId: "369239455736",
            appId: "1:369239455736:web:116295854269abecf6480d",
            measurementId: "G-R2MG1YKQEP"
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        
        // Check if user is admin
        function checkUserSession() {
            const userData = localStorage.getItem('currentUser');
            
            if (!userData) {
                window.location.href = 'index.html';
                return false;
            }
            
            const user = JSON.parse(userData);
            
            if (user.role !== 'admin') {
                window.location.href = 'employee-dashboard.html';
                return false;
            }
            
            return true;
        }
        
        // Load Settings
        async function loadSettings() {
            try {
                const snapshot = await database.ref('settings').once('value');
                
                if (snapshot.exists()) {
                    const settings = snapshot.val();
                    
                    // General Settings
                    if (settings.general) {
                        if (settings.general.companyName) {
                            document.getElementById('companyName').value = settings.general.companyName;
                        }
                        if (settings.general.timezone) {
                            document.getElementById('timezone').value = settings.general.timezone;
                        }
                        if (settings.general.dateFormat) {
                            document.getElementById('dateFormat').value = settings.general.dateFormat;
                        }
                        if (settings.general.primaryColor) {
                            document.getElementById('primaryColor').value = settings.general.primaryColor;
                        }
                    }
                    
                    // Attendance Settings
                    if (settings.attendance) {
                        if (settings.attendance.workStartTime) {
                            document.getElementById('workStartTime').value = settings.attendance.workStartTime;
                        }
                        if (settings.attendance.workEndTime) {
                            document.getElementById('workEndTime').value = settings.attendance.workEndTime;
                        }
                        if (settings.attendance.lateThreshold) {
                            document.getElementById('lateThreshold').value = settings.attendance.lateThreshold;
                        }
                        if (settings.attendance.radius) {
                            document.getElementById('attendanceRadius').value = settings.attendance.radius;
                            document.getElementById('radiusValue').textContent = settings.attendance.radius + ' متر';
                        }
                        if (settings.attendance.enableLocationCheck !== undefined) {
                            document.getElementById('enableLocationCheck').checked = settings.attendance.enableLocationCheck;
                        }
                    }
                    
                    // Location Settings
                    if (settings.location) {
                        if (settings.location.lat) {
                            document.getElementById('locationLat').value = settings.location.lat;
                        }
                        if (settings.location.lng) {
                            document.getElementById('locationLng').value = settings.location.lng;
                        }
                        if (settings.location.address) {
                            document.getElementById('workAddress').value = settings.location.address;
                        }
                        if (settings.location.updateInterval) {
                            document.getElementById('locationUpdateInterval').value = settings.location.updateInterval;
                        }
                    }
                    
                    // Notification Settings
                    if (settings.notifications) {
                        if (settings.notifications.enableAll !== undefined) {
                            document.getElementById('enableAllNotifications').checked = settings.notifications.enableAll;
                        }
                        if (settings.notifications.dailyReportTime) {
                            document.getElementById('dailyReportTime').value = settings.notifications.dailyReportTime;
                        }
                        if (settings.notifications.email) {
                            document.getElementById('notificationEmail').value = settings.notifications.email;
                        }
                    }
                    
                    // Security Settings
                    if (settings.security) {
                        if (settings.security.passwordStrength) {
                            document.getElementById('passwordStrength').value = settings.security.passwordStrength;
                        }
                        if (settings.security.maxLoginAttempts) {
                            document.getElementById('maxLoginAttempts').value = settings.security.maxLoginAttempts;
                        }
                        if (settings.security.enable2FA !== undefined) {
                            document.getElementById('enable2FA').checked = settings.security.enable2FA;
                        }
                    }
                    
                    // Backup Settings
                    if (settings.backup) {
                        if (settings.backup.enableAutoBackup !== undefined) {
                            document.getElementById('enableAutoBackup').checked = settings.backup.enableAutoBackup;
                        }
                        if (settings.backup.time) {
                            document.getElementById('backupTime').value = settings.backup.time;
                        }
                    }
                    
                    console.log('تم تحميل الإعدادات بنجاح');
                }
            } catch (error) {
                console.error('خطأ في تحميل الإعدادات:', error);
            }
        }
        
        // Save Settings
        async function saveSettings() {
            const settings = {
                general: {
                    companyName: document.getElementById('companyName').value,
                    timezone: document.getElementById('timezone').value,
                    dateFormat: document.getElementById('dateFormat').value,
                    primaryColor: document.getElementById('primaryColor').value,
                    updatedAt: firebase.database.ServerValue.TIMESTAMP
                },
                attendance: {
                    workStartTime: document.getElementById('workStartTime').value,
                    workEndTime: document.getElementById('workEndTime').value,
                    checkInBuffer: document.getElementById('checkInBuffer').value,
                    lateThreshold: document.getElementById('lateThreshold').value,
                    radius: document.getElementById('attendanceRadius').value,
                    enableLocationCheck: document.getElementById('enableLocationCheck').checked,
                    updatedAt: firebase.database.ServerValue.TIMESTAMP
                },
                location: {
                    lat: document.getElementById('locationLat').value,
                    lng: document.getElementById('locationLng').value,
                    address: document.getElementById('workAddress').value,
                    updateInterval: document.getElementById('locationUpdateInterval').value,
                    accuracy: document.getElementById('gpsAccuracy').value,
                    updatedAt: firebase.database.ServerValue.TIMESTAMP
                },
                notifications: {
                    enableAll: document.getElementById('enableAllNotifications').checked,
                    enableAttendance: document.getElementById('enableAttendanceNotifications').checked,
                    enableLate: document.getElementById('enableLateNotifications').checked,
                    enableAbsent: document.getElementById('enableAbsentNotifications').checked,
                    enableEmail: document.getElementById('enableEmailNotifications').checked,
                    enablePush: document.getElementById('enablePushNotifications').checked,
                    dailyReportTime: document.getElementById('dailyReportTime').value,
                    email: document.getElementById('notificationEmail').value,
                    updatedAt: firebase.database.ServerValue.TIMESTAMP
                },
                security: {
                    passwordStrength: document.getElementById('passwordStrength').value,
                    passwordExpiry: document.getElementById('passwordExpiry').value,
                    maxLoginAttempts: document.getElementById('maxLoginAttempts').value,
                    lockoutDuration: document.getElementById('lockoutDuration').value,
                    allowMultipleSessions: document.getElementById('allowMultipleSessions').checked,
                    enable2FA: document.getElementById('enable2FA').checked,
                    enableActivityLog: document.getElementById('enableActivityLog').checked,
                    logRetention: document.getElementById('logRetention').value,
                    updatedAt: firebase.database.ServerValue.TIMESTAMP
                },
                backup: {
                    enableAutoBackup: document.getElementById('enableAutoBackup').checked,
                    time: document.getElementById('backupTime').value,
                    frequency: document.getElementById('backupFrequency').value,
                    count: document.getElementById('backupCount').value,
                    location: document.getElementById('backupLocation').value,
                    updatedAt: firebase.database.ServerValue.TIMESTAMP
                },
                advanced: {
                    debugMode: document.getElementById('debugMode').checked,
                    maintenanceMode: document.getElementById('maintenanceMode').checked,
                    maintenanceMessage: document.getElementById('maintenanceMessage').value,
                    connectionTimeout: document.getElementById('connectionTimeout').value,
                    enableCache: document.getElementById('enableCache').checked,
                    cacheDuration: document.getElementById('cacheDuration').value,
                    updatedAt: firebase.database.ServerValue.TIMESTAMP
                }
            };
            
            try {
                await database.ref('settings').set(settings);
                showNotification('تم حفظ الإعدادات بنجاح', 'success');
            } catch (error) {
                showNotification('حدث خطأ في حفظ الإعدادات', 'danger');
                console.error('خطأ:', error);
            }
        }
        
        // Reset to Default Settings
        function resetToDefaults() {
            if (confirm('هل أنت متأكد من استعادة الإعدادات الافتراضية؟ سيتم فقدان جميع الإعدادات الحالية.')) {
                // Reset all settings to defaults
                document.getElementById('companyName').value = 'شركة التقنية المبتكرة';
                document.getElementById('workStartTime').value = '08:00';
                document.getElementById('workEndTime').value = '17:00';
                document.getElementById('attendanceRadius').value = 100;
                document.getElementById('radiusValue').textContent = '100 متر';
                document.getElementById('enableLocationCheck').checked = true;
                document.getElementById('enableAllNotifications').checked = true;
                
                showNotification('تم استعادة الإعدادات الافتراضية', 'success');
            }
        }
        
        // Show Notification
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `alert alert-${type} alert-dismissible fade show position-fixed`;
            notification.style.cssText = 'top: 20px; left: 20px; z-index: 9999; min-width: 300px;';
            notification.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 5000);
        }
        
        // Event Listeners
        document.getElementById('saveAllSettings').addEventListener('click', saveSettings);
        document.getElementById('resetSettings').addEventListener('click', resetToDefaults);
        
        // Attendance Radius Slider
        document.getElementById('attendanceRadius').addEventListener('input', function() {
            document.getElementById('radiusValue').textContent = this.value + ' متر';
        });
        
        // Add Branch Location
        document.getElementById('addBranchLocation').addEventListener('click', function() {
            const branchLocations = document.getElementById('branchLocations');
            const count = branchLocations.children.length + 1;
            
            const branchDiv = document.createElement('div');
            branchDiv.className = 'card mb-3';
            branchDiv.innerHTML = `
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h6 class="mb-0">الموقع الفرعي ${count}</h6>
                        <button type="button" class="btn btn-sm btn-outline-danger remove-branch">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label">اسم الموقع</label>
                            <input type="text" class="form-control branch-name" placeholder="مثال: فرع النخيل">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">نطاق التسجيل (متر)</label>
                            <input type="number" class="form-control branch-radius" value="100" min="10">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">خط العرض</label>
                            <input type="text" class="form-control branch-lat" placeholder="24.XXXXXX">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">خط الطول</label>
                            <input type="text" class="form-control branch-lng" placeholder="46.XXXXXX">
                        </div>
                        <div class="col-12">
                            <label class="form-label">العنوان</label>
                            <textarea class="form-control branch-address" rows="2" placeholder="عنوان الموقع"></textarea>
                        </div>
                    </div>
                </div>
            `;
            
            branchLocations.appendChild(branchDiv);
            
            // Add event listener to remove button
            branchDiv.querySelector('.remove-branch').addEventListener('click', function() {
                branchDiv.remove();
            });
        });
        
        // Create Backup
        document.getElementById('createBackupBtn').addEventListener('click', async function() {
            try {
                // Get all data
                const snapshot = await database.ref().once('value');
                const data = snapshot.val();
                
                // Create backup file
                const backupData = {
                    timestamp: new Date().toISOString(),
                    data: data
                };
                
                // In real app, you would save this to Firebase Storage or download it
                const blob = new Blob([JSON.stringify(backupData, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `backup_${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                
                showNotification('تم إنشاء النسخة الاحتياطية بنجاح', 'success');
            } catch (error) {
                showNotification('حدث خطأ في إنشاء النسخة الاحتياطية', 'danger');
                console.error('خطأ:', error);
            }
        });
        
        // Danger Zone Actions
        document.getElementById('clearCacheBtn').addEventListener('click', function() {
            if (confirm('هل أنت متأكد من مسح الذاكرة المؤقتة؟')) {
                // Clear local storage cache
                localStorage.removeItem('settings_cache');
                showNotification('تم مسح الذاكرة المؤقتة', 'success');
            }
        });
        
        document.getElementById('clearLogsBtn').addEventListener('click', function() {
            if (confirm('هل أنت متأكد من مسح سجلات النظام؟')) {
                showNotification('تم مسح سجلات النظام', 'success');
            }
        });
        
        document.getElementById('resetDatabaseBtn').addEventListener('click', function() {
            if (confirm('هل أنت متأكد من إعادة تعيين قاعدة البيانات؟ هذا الإجراء لا يمكن التراجع عنه!')) {
                showNotification('إعادة تعيين قاعدة البيانات تتطلب صلاحيات إضافية', 'warning');
            }
        });
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            if (!checkUserSession()) return;
            
            loadSettings();
            
            // Initialize tab navigation
            const triggerTabList = document.querySelectorAll('#myTab button');
            triggerTabList.forEach(triggerEl => {
                const tabTrigger = new bootstrap.Tab(triggerEl);
                triggerEl.addEventListener('click', event => {
                    event.preventDefault();
                    tabTrigger.show();
                });
            });
        });
    </script>
</body>
</html>
