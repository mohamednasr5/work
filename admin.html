<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#1e40af">
    <title>ğŸ“Š Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„Ø§Ù†ØµØ±Ø§Ù</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href='https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.css' rel='stylesheet' />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Cairo', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary: #1e40af;
            --primary-dark: #1e3a8a;
            --primary-light: #3b82f6;
            --secondary: #7c3aed;
            --success: #10b981;
            --success-dark: #059669;
            --danger: #ef4444;
            --danger-dark: #dc2626;
            --warning: #f59e0b;
            --warning-dark: #d97706;
            --info: #0ea5e9;
            --dark: #1f2937;
            --dark-light: #374151;
            --light: #f9fafb;
            --gray: #6b7280;
            --gray-light: #e5e7eb;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            --shadow-xl: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            --radius: 12px;
            --radius-lg: 16px;
            --radius-xl: 20px;
        }

        body {
            background: linear-gradient(135deg, #1e3a8a 0%, #3730a3 100%);
            min-height: 100vh;
            padding: 20px;
            color: var(--dark);
        }

        .admin-container {
            max-width: 1600px;
            margin: 0 auto;
        }

        /* Login Screen */
        .login-screen {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .login-box {
            background: white;
            padding: 50px;
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-xl);
            width: 100%;
            max-width: 450px;
            text-align: center;
        }

        .login-icon {
            font-size: 64px;
            color: var(--primary);
            margin-bottom: 20px;
        }

        .login-title {
            font-size: 28px;
            color: var(--dark);
            margin-bottom: 10px;
            font-weight: 700;
        }

        .login-subtitle {
            color: var(--gray);
            margin-bottom: 30px;
            font-size: 16px;
        }

        .form-group {
            margin-bottom: 25px;
            text-align: right;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark);
            font-size: 14px;
        }

        .form-group input {
            width: 100%;
            padding: 15px;
            border: 2px solid var(--gray-light);
            border-radius: var(--radius);
            font-size: 16px;
            transition: all 0.3s;
            text-align: right;
        }

        .form-group input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(30, 64, 175, 0.1);
        }

        .password-input {
            position: relative;
        }

        .password-toggle {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--gray);
            cursor: pointer;
            font-size: 18px;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: var(--radius);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            width: 100%;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(30, 64, 175, 0.3);
        }

        /* Admin Dashboard (Hidden by default) */
        .admin-dashboard {
            display: none;
        }

        /* Header */
        .dashboard-header {
            background: white;
            padding: 25px 35px;
            border-radius: var(--radius-xl);
            margin-bottom: 30px;
            box-shadow: var(--shadow-lg);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .header-left h1 {
            font-size: 28px;
            color: var(--dark);
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .header-left p {
            color: var(--gray);
            font-size: 14px;
        }

        .header-actions {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success), var(--success-dark));
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger), var(--danger-dark));
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--warning), var(--warning-dark));
            color: white;
        }

        .btn-info {
            background: linear-gradient(135deg, var(--info), #0284c7);
            color: white;
        }

        /* Stats Overview */
        .stats-overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
            transition: all 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
        }

        .stat-card.success::before {
            background: linear-gradient(90deg, var(--success), var(--success-dark));
        }

        .stat-card.warning::before {
            background: linear-gradient(90deg, var(--warning), var(--warning-dark));
        }

        .stat-card.danger::before {
            background: linear-gradient(90deg, var(--danger), var(--danger-dark));
        }

        .stat-card.info::before {
            background: linear-gradient(90deg, var(--info), #0284c7);
        }

        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }

        .stat-icon {
            font-size: 42px;
            opacity: 0.2;
            color: var(--primary);
        }

        .stat-card.success .stat-icon { color: var(--success); }
        .stat-card.warning .stat-icon { color: var(--warning); }
        .stat-card.danger .stat-icon { color: var(--danger); }
        .stat-card.info .stat-icon { color: var(--info); }

        .stat-label {
            font-size: 14px;
            color: var(--gray);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 36px;
            font-weight: bold;
            color: var(--dark);
            margin-bottom: 10px;
        }

        .stat-change {
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 5px;
            font-weight: 600;
        }

        .stat-change.positive {
            color: var(--success);
        }

        .stat-change.negative {
            color: var(--danger);
        }

        /* Main Content Grid */
        .content-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 25px;
            margin-bottom: 30px;
        }

        @media (max-width: 1200px) {
            .content-grid {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: white;
            padding: 30px;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow);
            height: fit-content;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--gray-light);
        }

        .card-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            background: var(--gray-light);
            padding: 5px;
            border-radius: var(--radius);
        }

        .tab {
            flex: 1;
            padding: 12px;
            border: none;
            background: transparent;
            border-radius: var(--radius);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            color: var(--gray);
            text-align: center;
        }

        .tab.active {
            background: white;
            color: var(--primary);
            box-shadow: var(--shadow);
        }

        /* Filter Section */
        .filter-section {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .filter-group {
            flex: 1;
            min-width: 200px;
        }

        .filter-group label {
            display: block;
            font-size: 13px;
            font-weight: 600;
            color: var(--gray);
            margin-bottom: 8px;
        }

        .filter-group select,
        .filter-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--gray-light);
            border-radius: var(--radius);
            font-size: 14px;
            transition: all 0.3s;
            text-align: right;
        }

        .filter-group select:focus,
        .filter-group input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(30, 64, 175, 0.1);
        }

        /* Records Table */
        .records-table-container {
            overflow-x: auto;
            border-radius: var(--radius);
            border: 1px solid var(--gray-light);
        }

        .records-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }

        .records-table thead {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
        }

        .records-table th {
            padding: 16px;
            text-align: right;
            font-size: 13px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .records-table td {
            padding: 16px;
            border-bottom: 1px solid var(--gray-light);
            font-size: 14px;
            color: var(--dark);
        }

        .records-table tbody tr {
            transition: all 0.3s;
        }

        .records-table tbody tr:hover {
            background: var(--light);
        }

        /* Badges */
        .badge {
            display: inline-block;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .badge-success {
            background: #d1fae5;
            color: #065f46;
        }

        .badge-danger {
            background: #fee2e2;
            color: #991b1b;
        }

        .badge-warning {
            background: #fef3c7;
            color: #92400e;
        }

        .badge-info {
            background: #dbeafe;
            color: #1e40af;
        }

        .badge-primary {
            background: #dbeafe;
            color: var(--primary-dark);
        }

        /* Employee List */
        .employee-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
            max-height: 600px;
            overflow-y: auto;
            padding-right: 5px;
        }

        .employee-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 20px;
            background: var(--light);
            border-radius: var(--radius);
            transition: all 0.3s;
            border: 2px solid transparent;
            cursor: pointer;
        }

        .employee-item:hover {
            background: white;
            border-color: var(--primary);
            box-shadow: var(--shadow);
        }

        .employee-avatar {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
            font-weight: bold;
            flex-shrink: 0;
        }

        .employee-info {
            flex: 1;
        }

        .employee-name {
            font-weight: 600;
            font-size: 16px;
            color: var(--dark);
            margin-bottom: 3px;
        }

        .employee-details {
            font-size: 13px;
            color: var(--gray);
        }

        .employee-status {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 5px;
            flex-shrink: 0;
        }

        /* Live Map */
        .map-container {
            height: 400px;
            border-radius: var(--radius);
            overflow: hidden;
            margin-bottom: 25px;
            box-shadow: var(--shadow);
            position: relative;
        }

        #liveMap {
            width: 100%;
            height: 100%;
        }

        .map-overlay {
            position: absolute;
            top: 15px;
            left: 15px;
            background: white;
            padding: 10px 15px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            font-size: 13px;
            z-index: 10;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .map-legend {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 12px;
        }

        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        /* Charts Container */
        .charts-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .chart-card {
            background: white;
            padding: 25px;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow);
        }

        .chart-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .chart-wrapper {
            height: 250px;
            position: relative;
        }

        /* Quick Stats */
        .quick-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .quick-stat {
            padding: 20px;
            background: linear-gradient(135deg, var(--light), white);
            border-radius: var(--radius);
            border-right: 4px solid var(--primary);
        }

        .quick-stat-value {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 5px;
        }

        .quick-stat-label {
            font-size: 12px;
            color: var(--gray);
            font-weight: 600;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--gray);
        }

        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        .empty-state h3 {
            font-size: 18px;
            margin-bottom: 10px;
            color: var(--dark-light);
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 40px;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid var(--gray-light);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Modals */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            backdrop-filter: blur(5px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            padding: 20px;
        }

        .modal.show {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: white;
            padding: 40px;
            border-radius: var(--radius-xl);
            max-width: 600px;
            width: 100%;
            box-shadow: var(--shadow-xl);
            animation: modalSlideIn 0.3s ease;
            max-height: 90vh;
            overflow-y: auto;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .modal-icon {
            font-size: 64px;
            margin-bottom: 15px;
            color: var(--primary);
        }

        .modal-header h3 {
            font-size: 26px;
            color: var(--dark);
            margin-bottom: 10px;
        }

        .form-actions {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        .form-actions .btn {
            flex: 1;
        }

        .btn-outline {
            background: white;
            color: var(--gray);
            border: 2px solid var(--gray-light);
        }

        .btn-outline:hover {
            background: var(--light);
            border-color: var(--gray);
        }

        /* Table Actions */
        .table-actions {
            display: flex;
            gap: 8px;
        }

        .action-btn {
            width: 35px;
            height: 35px;
            border-radius: 8px;
            border: none;
            background: var(--gray-light);
            color: var(--dark);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .action-btn:hover {
            transform: translateY(-2px);
        }

        .action-btn.edit {
            background: #dbeafe;
            color: var(--primary);
        }

        .action-btn.delete {
            background: #fee2e2;
            color: var(--danger);
        }

        .action-btn.view {
            background: #d1fae5;
            color: var(--success);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .dashboard-header {
                flex-direction: column;
                align-items: stretch;
                text-align: center;
            }

            .header-actions {
                justify-content: center;
            }

            .stats-overview {
                grid-template-columns: 1fr;
            }

            .filter-section {
                flex-direction: column;
            }

            .filter-group {
                min-width: 100%;
            }

            .login-box {
                padding: 30px;
            }

            .charts-container {
                grid-template-columns: 1fr;
            }
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: white;
            padding: 15px 20px;
            border-radius: var(--radius);
            box-shadow: var(--shadow-xl);
            display: none;
            align-items: center;
            gap: 12px;
            z-index: 9998;
            max-width: 350px;
            animation: slideInUp 0.3s ease;
            border-right: 4px solid var(--primary);
        }

        @keyframes slideInUp {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .toast.show {
            display: flex;
        }

        .toast.success {
            border-right-color: var(--success);
        }

        .toast.error {
            border-right-color: var(--danger);
        }

        .toast.warning {
            border-right-color: var(--warning);
        }

        .toast-icon {
            font-size: 20px;
        }

        .toast.success .toast-icon { color: var(--success); }
        .toast.error .toast-icon { color: var(--danger); }
        .toast.warning .toast-icon { color: var(--warning); }

        .toast-content {
            flex: 1;
        }

        .toast-title {
            font-weight: 600;
            margin-bottom: 3px;
            color: var(--dark);
        }

        .toast-message {
            font-size: 13px;
            color: var(--gray);
        }

        .toast-close {
            background: none;
            border: none;
            color: var(--gray);
            cursor: pointer;
            font-size: 16px;
            padding: 5px;
        }

        /* Search Box */
        .search-box {
            position: relative;
            margin-bottom: 25px;
        }

        .search-box input {
            width: 100%;
            padding: 15px 45px 15px 15px;
            border: 2px solid var(--gray-light);
            border-radius: var(--radius);
            font-size: 16px;
            transition: all 0.3s;
        }

        .search-box input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(30, 64, 175, 0.1);
        }

        .search-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray);
            font-size: 18px;
        }

        /* Time Display */
        .time-display {
            font-family: 'Courier New', monospace;
            font-size: 14px;
            color: var(--gray);
            background: var(--light);
            padding: 8px 15px;
            border-radius: var(--radius);
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        /* Employee Status Colors */
        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            display: inline-block;
            margin-left: 5px;
        }

        .status-online { background: var(--success); }
        .status-offline { background: var(--gray); }
        .status-checked-in { background: var(--primary); }
        .status-checked-out { background: var(--danger); }
        .status-away { background: var(--warning); }

        /* Dashboard Widgets */
        .widget-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .widget {
            background: white;
            padding: 20px;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow);
        }

        .widget-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .widget-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--dark);
        }

        .widget-value {
            font-size: 28px;
            font-weight: bold;
            color: var(--primary);
        }

        /* Data Export */
        .export-options {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 20px;
        }

        .export-btn {
            padding: 10px 20px;
            border-radius: var(--radius);
            border: 2px solid var(--gray-light);
            background: white;
            color: var(--dark);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .export-btn:hover {
            border-color: var(--primary);
            color: var(--primary);
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div class="login-screen" id="loginScreen">
        <div class="login-box">
            <div class="login-icon">
                <i class="fas fa-lock"></i>
            </div>
            <h1 class="login-title">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø¥Ø¯Ø§Ø±ÙŠØ©</h1>
            <p class="login-subtitle">Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù„Ù„Ø¯Ø®ÙˆÙ„</p>
            
            <form id="adminLoginForm">
                <div class="form-group">
                    <label><i class="fas fa-key"></i> ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                    <div class="password-input">
                        <input type="password" id="adminPassword" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" required>
                        <button type="button" class="password-toggle" id="togglePassword">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                    <p style="font-size: 12px; color: var(--gray); margin-top: 8px;">
                        ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±: <strong>742018</strong>
                    </p>
                </div>
                
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-sign-in-alt"></i>
                    Ø¯Ø®ÙˆÙ„ Ø¥Ù„Ù‰ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
                </button>
            </form>
        </div>
    </div>

    <!-- Admin Dashboard -->
    <div class="admin-dashboard" id="adminDashboard">
        <div class="admin-container">
            <!-- Header -->
            <div class="dashboard-header">
                <div class="header-left">
                    <h1><i class="fas fa-tachometer-alt"></i> Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©</h1>
                    <p>
                        <span class="time-display">
                            <i class="fas fa-clock"></i>
                            <span id="currentDate">Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡ØŒ 30 Ø¯ÙŠØ³Ù…Ø¨Ø± 2025</span>
                            -
                            <span id="currentTime">00:00:00</span>
                        </span>
                    </p>
                </div>
                <div class="header-actions">
                    <button class="btn btn-success" onclick="refreshData()">
                        <i class="fas fa-sync-alt"></i> ØªØ­Ø¯ÙŠØ«
                    </button>
                    <button class="btn btn-warning" onclick="exportToExcel()">
                        <i class="fas fa-file-excel"></i> ØªØµØ¯ÙŠØ± Excel
                    </button>
                    <button class="btn btn-info" onclick="showAddEmployeeModal()">
                        <i class="fas fa-user-plus"></i> Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸Ù
                    </button>
                    <button class="btn btn-danger" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i> Ø®Ø±ÙˆØ¬
                    </button>
                </div>
            </div>

            <!-- Stats Overview -->
            <div class="stats-overview">
                <div class="stat-card success">
                    <div class="stat-header">
                        <div>
                            <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</div>
                            <div class="stat-value" id="totalEmployees">0</div>
                            <div class="stat-change positive" id="employeeChange">
                                <i class="fas fa-arrow-up"></i> 0%
                            </div>
                        </div>
                        <div class="stat-icon"><i class="fas fa-users"></i></div>
                    </div>
                </div>

                <div class="stat-card info">
                    <div class="stat-header">
                        <div>
                            <div class="stat-label">Ø§Ù„Ø­Ø§Ø¶Ø±ÙˆÙ† Ø§Ù„ÙŠÙˆÙ…</div>
                            <div class="stat-value" id="presentToday">0</div>
                            <div class="stat-change" id="presentChange">Ø§Ù„ÙŠÙˆÙ…</div>
                        </div>
                        <div class="stat-icon"><i class="fas fa-user-check"></i></div>
                    </div>
                </div>

                <div class="stat-card warning">
                    <div class="stat-header">
                        <div>
                            <div class="stat-label">Ù…ØªÙˆØ³Ø· Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„</div>
                            <div class="stat-value" id="avgWorkHours">0:00</div>
                            <div class="stat-change">Ø§Ù„ÙŠÙˆÙ…</div>
                        </div>
                        <div class="stat-icon"><i class="fas fa-clock"></i></div>
                    </div>
                </div>

                <div class="stat-card danger">
                    <div class="stat-header">
                        <div>
                            <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ø¬Ù„Ø§Øª</div>
                            <div class="stat-value" id="totalRecords">0</div>
                            <div class="stat-change">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ÙˆÙ‚Ø§Øª</div>
                        </div>
                        <div class="stat-icon"><i class="fas fa-database"></i></div>
                    </div>
                </div>
            </div>

            <!-- Live Map -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title"><i class="fas fa-map-marked-alt"></i> Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø­ÙŠØ©</h2>
                    <div class="map-overlay">
                        <div class="map-legend">
                            <div class="legend-item">
                                <span class="legend-color" style="background: #10b981;"></span>
                                <span>Ø¯Ø§Ø®Ù„ Ø§Ù„Ø¹Ù…Ù„</span>
                            </div>
                            <div class="legend-item">
                                <span class="legend-color" style="background: #ef4444;"></span>
                                <span>Ø®Ø§Ø±Ø¬ Ø§Ù„Ø¹Ù…Ù„</span>
                            </div>
                            <div class="legend-item">
                                <span class="legend-color" style="background: #1e40af;"></span>
                                <span>Ù…Ù‚Ø± Ø§Ù„Ø¹Ù…Ù„</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="map-container">
                    <div id="liveMap"></div>
                </div>
                <div style="text-align: center; margin-top: 15px; font-size: 14px; color: var(--gray);">
                    <i class="fas fa-info-circle"></i> ØªØªØ¨Ø¹ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø©
                </div>
            </div>

            <!-- Charts Section -->
            <div class="charts-container">
                <div class="chart-card">
                    <h3 class="chart-title"><i class="fas fa-chart-pie"></i> ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø­Ø¶ÙˆØ±</h3>
                    <div class="chart-wrapper">
                        <canvas id="attendanceChart"></canvas>
                    </div>
                </div>
                <div class="chart-card">
                    <h3 class="chart-title"><i class="fas fa-chart-line"></i> Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„</h3>
                    <div class="chart-wrapper">
                        <canvas id="hoursChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Main Content Grid -->
            <div class="content-grid">
                <!-- Records Section -->
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title"><i class="fas fa-clipboard-list"></i> Ø³Ø¬Ù„Ø§Øª Ø§Ù„Ø­Ø¶ÙˆØ± ÙˆØ§Ù„Ø§Ù†ØµØ±Ø§Ù</h2>
                        <button class="btn btn-primary" style="padding: 10px 20px; font-size: 14px;" onclick="showAllRecords()">
                            <i class="fas fa-eye"></i> Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„
                        </button>
                    </div>

                    <div class="search-box">
                        <i class="fas fa-search search-icon"></i>
                        <input type="text" id="searchRecords" placeholder="Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø³Ø¬Ù„Ø§Øª..." oninput="searchRecords()">
                    </div>

                    <div class="filter-section">
                        <div class="filter-group">
                            <label>Ø§Ù„Ù…ÙˆØ¸Ù</label>
                            <select id="filterEmployee" onchange="filterRecords()">
                                <option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label>Ø§Ù„ØªØ§Ø±ÙŠØ®</label>
                            <input type="date" id="filterDate" onchange="filterRecords()">
                        </div>
                        <div class="filter-group">
                            <label>Ø§Ù„Ù†ÙˆØ¹</label>
                            <select id="filterType" onchange="filterRecords()">
                                <option value="">Ø§Ù„ÙƒÙ„</option>
                                <option value="checkin">Ø­Ø¶ÙˆØ±</option>
                                <option value="checkout">Ø§Ù†ØµØ±Ø§Ù</option>
                            </select>
                        </div>
                    </div>

                    <div class="tabs">
                        <button class="tab active" onclick="switchTab('today')">Ø§Ù„ÙŠÙˆÙ…</button>
                        <button class="tab" onclick="switchTab('week')">Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</button>
                        <button class="tab" onclick="switchTab('month')">Ø§Ù„Ø´Ù‡Ø±</button>
                        <button class="tab" onclick="switchTab('all')">Ø§Ù„ÙƒÙ„</button>
                    </div>

                    <div class="records-table-container">
                        <table class="records-table" id="recordsTable">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Ø§Ù„Ù…ÙˆØ¸Ù</th>
                                    <th>Ø§Ù„Ù‚Ø³Ù…</th>
                                    <th>Ø§Ù„Ù†ÙˆØ¹</th>
                                    <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                    <th>Ø§Ù„ÙˆÙ‚Øª</th>
                                    <th>Ø§Ù„Ù…ÙˆÙ‚Ø¹</th>
                                    <th>Ø§Ù„Ù…Ø³Ø§ÙØ©</th>
                                    <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                                </tr>
                            </thead>
                            <tbody id="recordsBody">
                                <tr>
                                    <td colspan="9" style="text-align: center; padding: 40px;">
                                        <div class="loading">
                                            <div class="spinner"></div>
                                            <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø³Ø¬Ù„Ø§Øª...</p>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="export-options">
                        <button class="export-btn" onclick="exportToPDF()">
                            <i class="fas fa-file-pdf"></i> PDF
                        </button>
                        <button class="export-btn" onclick="exportToCSV()">
                            <i class="fas fa-file-csv"></i> CSV
                        </button>
                        <button class="export-btn" onclick="printRecords()">
                            <i class="fas fa-print"></i> Ø·Ø¨Ø§Ø¹Ø©
                        </button>
                    </div>
                </div>

                <!-- Employees Section -->
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title"><i class="fas fa-users"></i> Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</h2>
                        <div class="quick-stats">
                            <div class="quick-stat">
                                <div class="quick-stat-value" id="activeEmployees">0</div>
                                <div class="quick-stat-label">Ù†Ø´Ø· Ø§Ù„Ø¢Ù†</div>
                            </div>
                            <div class="quick-stat">
                                <div class="quick-stat-value" id="offlineEmployees">0</div>
                                <div class="quick-stat-label">Ø®Ø§Ø±Ø¬ Ø§Ù„Ø¹Ù…Ù„</div>
                            </div>
                        </div>
                    </div>

                    <div class="search-box">
                        <i class="fas fa-search search-icon"></i>
                        <input type="text" id="searchEmployees" placeholder="Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†..." oninput="searchEmployees()">
                    </div>

                    <div id="employeeList" class="employee-list">
                        <div class="loading">
                            <div class="spinner"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Dashboard Widgets -->
            <div class="widget-grid">
                <div class="widget">
                    <div class="widget-header">
                        <div class="widget-title">Ø£ÙƒØ«Ø± Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† Ø­Ø¶ÙˆØ±Ø§Ù‹</div>
                        <i class="fas fa-trophy" style="color: #f59e0b;"></i>
                    </div>
                    <div class="widget-value" id="topEmployee">-</div>
                    <div style="font-size: 12px; color: var(--gray); margin-top: 5px;" id="topEmployeeHours">Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„</div>
                </div>

                <div class="widget">
                    <div class="widget-header">
                        <div class="widget-title">Ø¢Ø®Ø± ØªØ³Ø¬ÙŠÙ„ Ø­Ø¶ÙˆØ±</div>
                        <i class="fas fa-history"></i>
                    </div>
                    <div class="widget-value" id="lastCheckInTime">-</div>
                    <div style="font-size: 12px; color: var(--gray); margin-top: 5px;" id="lastCheckInEmployee">Ø§Ù„Ù…ÙˆØ¸Ù</div>
                </div>

                <div class="widget">
                    <div class="widget-header">
                        <div class="widget-title">Ø£ÙƒØ«Ø± Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ù†Ø´Ø§Ø·Ø§Ù‹</div>
                        <i class="fas fa-building"></i>
                    </div>
                    <div class="widget-value" id="topDepartment">-</div>
                    <div style="font-size: 12px; color: var(--gray); margin-top: 5px;" id="topDepartmentCount">Ù…ÙˆØ¸ÙÙŠÙ†</div>
                </div>

                <div class="widget">
                    <div class="widget-header">
                        <div class="widget-title">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„</div>
                        <i class="fas fa-business-time"></i>
                    </div>
                    <div class="widget-value" id="totalWorkHours">0</div>
                    <div style="font-size: 12px; color: var(--gray); margin-top: 5px;">Ø§Ù„ÙŠÙˆÙ…</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <!-- Add Employee Modal -->
    <div class="modal" id="addEmployeeModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-icon"><i class="fas fa-user-plus"></i></div>
                <h3>Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸Ù Ø¬Ø¯ÙŠØ¯</h3>
                <p style="color: var(--gray); font-size: 14px;">Ø£Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ¸Ù Ø§Ù„Ø¬Ø¯ÙŠØ¯</p>
            </div>
            <form id="addEmployeeForm">
                <div class="form-group">
                    <label><i class="fas fa-id-card"></i> Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¸Ù</label>
                    <input type="text" id="newEmployeeId" placeholder="Ù…Ø«Ø§Ù„: EMP001" required>
                </div>
                <div class="form-group">
                    <label><i class="fas fa-user"></i> Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
                    <input type="text" id="newEmployeeName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„" required>
                </div>
                <div class="form-group">
                    <label><i class="fas fa-building"></i> Ø§Ù„Ù‚Ø³Ù…</label>
                    <input type="text" id="newEmployeeDepartment" placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª" required>
                </div>
                <div class="form-group">
                    <label><i class="fas fa-clock"></i> Ø§Ù„ÙˆØ±Ø¯ÙŠØ©</label>
                    <select id="newEmployeeShift" required>
                        <option value="">Ø§Ø®ØªØ± Ø§Ù„ÙˆØ±Ø¯ÙŠØ©</option>
                        <option value="morning">ØµØ¨Ø§Ø­ÙŠØ© (8:00 - 16:00)</option>
                        <option value="evening">Ù…Ø³Ø§Ø¦ÙŠØ© (16:00 - 00:00)</option>
                        <option value="night">Ù„ÙŠÙ„ÙŠØ© (00:00 - 8:00)</option>
                        <option value="flexible">Ù…Ø±Ù†Ø©</option>
                    </select>
                </div>
                <div class="form-group">
                    <label><i class="fas fa-mobile-alt"></i> Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
                    <input type="tel" id="newEmployeePhone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ">
                </div>
                <div class="form-group">
                    <label><i class="fas fa-envelope"></i> Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                    <input type="email" id="newEmployeeEmail" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-outline" onclick="closeModal('addEmployeeModal')">
                        Ø¥Ù„ØºØ§Ø¡
                    </button>
                    <button type="submit" class="btn btn-success">
                        <i class="fas fa-check"></i> Ø¥Ø¶Ø§ÙØ©
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Employee Details Modal -->
    <div class="modal" id="employeeDetailsModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-icon"><i class="fas fa-user-circle"></i></div>
                <h3 id="employeeModalTitle">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…ÙˆØ¸Ù</h3>
            </div>
            <div id="employeeDetailsContent">
                <!-- Content will be loaded dynamically -->
            </div>
            <div class="form-actions">
                <button type="button" class="btn btn-outline" onclick="closeModal('employeeDetailsModal')">
                    Ø¥ØºÙ„Ø§Ù‚
                </button>
                <button type="button" class="btn btn-danger" onclick="deleteEmployee()" id="deleteEmployeeBtn">
                    <i class="fas fa-trash"></i> Ø­Ø°Ù
                </button>
            </div>
        </div>
    </div>

    <!-- Record Details Modal -->
    <div class="modal" id="recordDetailsModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-icon"><i class="fas fa-info-circle"></i></div>
                <h3>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø³Ø¬Ù„</h3>
            </div>
            <div id="recordDetailsContent">
                <!-- Content will be loaded dynamically -->
            </div>
            <div class="form-actions">
                <button type="button" class="btn btn-outline" onclick="closeModal('recordDetailsModal')">
                    Ø¥ØºÙ„Ø§Ù‚
                </button>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal" id="settingsModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-icon"><i class="fas fa-cog"></i></div>
                <h3>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</h3>
            </div>
            <form id="settingsForm">
                <div class="form-group">
                    <label><i class="fas fa-map-marker-alt"></i> Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¹Ù…Ù„</label>
                    <input type="text" id="officeLatitude" placeholder="Ø®Ø· Ø§Ù„Ø¹Ø±Ø¶" required>
                    <input type="text" id="officeLongitude" placeholder="Ø®Ø· Ø§Ù„Ø·ÙˆÙ„" required style="margin-top: 10px;">
                </div>
                <div class="form-group">
                    <label><i class="fas fa-ruler"></i> Ù†Ø·Ø§Ù‚ Ø§Ù„Ø¹Ù…Ù„ (Ø¨Ø§Ù„Ø£Ù…ØªØ§Ø±)</label>
                    <input type="number" id="officeMaxDistance" placeholder="Ø§Ù„Ù…Ø³Ø§ÙØ© Ø§Ù„Ù‚ØµÙˆÙ‰" required>
                </div>
                <div class="form-group">
                    <label><i class="fas fa-clock"></i> ÙˆÙ‚Øª Ø¨Ø¯Ø¡ Ø§Ù„Ø¹Ù…Ù„</label>
                    <input type="time" id="workStartTime" required>
                </div>
                <div class="form-group">
                    <label><i class="fas fa-clock"></i> ÙˆÙ‚Øª Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø¹Ù…Ù„</label>
                    <input type="time" id="workEndTime" required>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-outline" onclick="closeModal('settingsModal')">
                        Ø¥Ù„ØºØ§Ø¡
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast">
        <div class="toast-icon" id="toastIcon">
            <i class="fas fa-info-circle"></i>
        </div>
        <div class="toast-content">
            <div class="toast-title" id="toastTitle">ØªÙ†Ø¨ÙŠÙ‡</div>
            <div class="toast-message" id="toastMessage">Ù‡Ø°Ù‡ Ø±Ø³Ø§Ù„Ø© ØªÙ†Ø¨ÙŠÙ‡</div>
        </div>
        <button class="toast-close" onclick="hideToast()">
            <i class="fas fa-times"></i>
        </button>
    </div>

    <!-- Scripts -->
    <script src='https://api.mapbox.com/mapbox-gl-js/v3.0.1/mapbox-gl.js'></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script type="module">
        // Firebase Configuration
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { 
            getDatabase, 
            ref, 
            set, 
            push, 
            get, 
            query, 
            orderByChild, 
            equalTo, 
            onValue, 
            serverTimestamp,
            update,
            remove,
            orderByKey,
            limitToLast
        } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

        const firebaseConfig = {
            apiKey: "AIzaSyC4J8ncbuejvzfWvzCTAXRzjFg_vrchXpE",
            authDomain: "hedor-bea3c.firebaseapp.com",
            databaseURL: "https://hedor-bea3c-default-rtdb.firebaseio.com",
            projectId: "hedor-bea3c",
            storageBucket: "hedor-bea3c.firebasestorage.app",
            messagingSenderId: "369239455736",
            appId: "1:369239455736:web:116295854269abecf6480d",
            measurementId: "G-R2MG1YKQEP"
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        // Admin Password
        const ADMIN_PASSWORD = "742018";

        // Global Variables
        let allRecords = [];
        let allEmployees = [];
        let filteredRecords = [];
        let liveMap = null;
        let employeeMarkers = [];
        let currentTab = 'today';
        let attendanceChart = null;
        let hoursChart = null;

        // Mapbox Configuration
        mapboxgl.accessToken = 'pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw';

        // Office Location
        const OFFICE_LOCATION = {
            latitude: 31.193788059713373,
            longitude: 31.981236556896377,
            maxDistance: 100,
            name: "Ø§Ù„Ù…Ù‚Ø± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ"
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            // Check if already logged in
            const isLoggedIn = localStorage.getItem('adminLoggedIn');
            if (isLoggedIn === 'true') {
                showAdminDashboard();
            }

            // Setup login form
            document.getElementById('adminLoginForm').addEventListener('submit', adminLogin);
            
            // Toggle password visibility
            document.getElementById('togglePassword').addEventListener('click', togglePasswordVisibility);
            
            // Update date and time
            updateDateTime();
            setInterval(updateDateTime, 1000);
        });

        // Admin Login
        async function adminLogin(event) {
            event.preventDefault();
            
            const password = document.getElementById('adminPassword').value;
            
            if (password === ADMIN_PASSWORD) {
                // Login successful
                localStorage.setItem('adminLoggedIn', 'true');
                showAdminDashboard();
                showToast('ØªÙ… Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­ Ø¥Ù„Ù‰ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…', 'success');
            } else {
                showToast('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©', 'error');
                document.getElementById('adminPassword').value = '';
                document.getElementById('adminPassword').focus();
            }
        }

        // Toggle password visibility
        function togglePasswordVisibility() {
            const passwordInput = document.getElementById('adminPassword');
            const toggleIcon = document.getElementById('togglePassword').querySelector('i');
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                toggleIcon.className = 'fas fa-eye-slash';
            } else {
                passwordInput.type = 'password';
                toggleIcon.className = 'fas fa-eye';
            }
        }

        // Show admin dashboard
        function showAdminDashboard() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('adminDashboard').style.display = 'block';
            
            // Initialize dashboard
            initializeDashboard();
        }

        // Initialize dashboard
        async function initializeDashboard() {
            // Initialize map
            initLiveMap();
            
            // Load data
            await loadAllData();
            
            // Initialize charts
            initCharts();
            
            // Start real-time updates
            startRealtimeUpdates();
        }

        // Initialize live map
        function initLiveMap() {
            try {
                liveMap = new mapboxgl.Map({
                    container: 'liveMap',
                    style: 'mapbox://styles/mapbox/streets-v12',
                    center: [OFFICE_LOCATION.longitude, OFFICE_LOCATION.latitude],
                    zoom: 15,
                    pitch: 45,
                    bearing: -20
                });

                liveMap.addControl(new mapboxgl.NavigationControl());
                liveMap.addControl(new mapboxgl.FullscreenControl());

                // Add office marker
                new mapboxgl.Marker({
                    color: '#1e40af',
                    scale: 1.3
                })
                .setLngLat([OFFICE_LOCATION.longitude, OFFICE_LOCATION.latitude])
                .setPopup(new mapboxgl.Popup().setHTML(`
                    <div style="padding: 10px;">
                        <h4 style="margin: 0 0 10px 0; color: #1e40af;">
                            <i class="fas fa-building"></i> ${OFFICE_LOCATION.name}
                        </h4>
                        <p style="margin: 0; font-size: 12px;">
                            <i class="fas fa-map-marker-alt"></i> 
                            ${OFFICE_LOCATION.latitude.toFixed(6)}, ${OFFICE_LOCATION.longitude.toFixed(6)}
                        </p>
                        <p style="margin: 5px 0 0 0; font-size: 11px; color: #666;">
                            <i class="fas fa-ruler"></i> Ù†Ø·Ø§Ù‚ Ø§Ù„Ø¹Ù…Ù„: ${OFFICE_LOCATION.maxDistance} Ù…ØªØ±
                        </p>
                    </div>
                `))
                .addTo(liveMap);

                // Add office radius
                liveMap.on('load', () => {
                    liveMap.addSource('office-radius', {
                        type: 'geojson',
                        data: {
                            type: 'Feature',
                            geometry: {
                                type: 'Point',
                                coordinates: [OFFICE_LOCATION.longitude, OFFICE_LOCATION.latitude]
                            }
                        }
                    });

                    liveMap.addLayer({
                        id: 'office-radius-layer',
                        type: 'circle',
                        source: 'office-radius',
                        paint: {
                            'circle-radius': {
                                stops: [
                                    [0, 0],
                                    [20, metersToPixelsAtMaxZoom(OFFICE_LOCATION.maxDistance, OFFICE_LOCATION.latitude)]
                                ],
                                base: 2
                            },
                            'circle-color': '#10b981',
                            'circle-opacity': 0.1,
                            'circle-stroke-color': '#10b981',
                            'circle-stroke-width': 2,
                            'circle-stroke-opacity': 0.3
                        }
                    });
                });

            } catch (error) {
                console.error('Error initializing live map:', error);
            }
        }

        // Helper function for map calculations
        function metersToPixelsAtMaxZoom(meters, latitude) {
            return meters / 0.075 / Math.cos(latitude * Math.PI / 180);
        }

        // Load all data
        async function loadAllData() {
            await loadEmployees();
            await loadRecords();
            updateDashboardStats();
            updateEmployeeList();
            updateRecordsTable();
            updateLiveMap();
            updateCharts();
        }

        // Load employees
        async function loadEmployees() {
            const employeesRef = ref(database, 'employees');
            
            return new Promise((resolve) => {
                onValue(employeesRef, (snapshot) => {
                    allEmployees = [];
                    snapshot.forEach((child) => {
                        allEmployees.push({
                            id: child.key,
                            ...child.val()
                        });
                    });
                    
                    // Update employee filter
                    updateEmployeeFilter();
                    resolve();
                });
            });
        }

        // Load records
        async function loadRecords() {
            const recordsRef = ref(database, 'attendance');
            
            return new Promise((resolve) => {
                onValue(recordsRef, (snapshot) => {
                    allRecords = [];
                    snapshot.forEach((child) => {
                        allRecords.push({
                            id: child.key,
                            ...child.val()
                        });
                    });
                    
                    // Sort by timestamp (newest first)
                    allRecords.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                    resolve();
                });
            });
        }

        // Update dashboard statistics
        function updateDashboardStats() {
            const today = new Date().toISOString().split('T')[0];
            
            // Total employees
            document.getElementById('totalEmployees').textContent = allEmployees.length;
            
            // Present today
            const todayCheckins = allRecords.filter(r => r.date === today && r.type === 'checkin');
            const uniqueEmployeesToday = new Set(todayCheckins.map(r => r.employeeId));
            document.getElementById('presentToday').textContent = uniqueEmployeesToday.size;
            
            // Average work hours
            let totalWorkMinutes = 0;
            let employeeWorkCount = 0;
            
            uniqueEmployeesToday.forEach(employeeId => {
                const employeeRecords = allRecords.filter(r => 
                    r.employeeId === employeeId && r.date === today
                );
                
                let employeeMinutes = 0;
                for (let i = 0; i < employeeRecords.length; i++) {
                    if (employeeRecords[i].type === 'checkin' && 
                        i + 1 < employeeRecords.length && 
                        employeeRecords[i + 1].type === 'checkout') {
                        
                        const checkinTime = new Date(employeeRecords[i].timestamp);
                        const checkoutTime = new Date(employeeRecords[i + 1].timestamp);
                        employeeMinutes += (checkoutTime - checkinTime) / 1000 / 60;
                    }
                }
                
                totalWorkMinutes += employeeMinutes;
                employeeWorkCount++;
            });
            
            const avgMinutes = employeeWorkCount > 0 ? totalWorkMinutes / employeeWorkCount : 0;
            const avgHours = Math.floor(avgMinutes / 60);
            const avgMins = Math.floor(avgMinutes % 60);
            
            document.getElementById('avgWorkHours').textContent = 
                `${avgHours}:${avgMins.toString().padStart(2, '0')}`;
            
            // Total records
            document.getElementById('totalRecords').textContent = allRecords.length;
            
            // Active employees
            const activeEmployees = allEmployees.filter(emp => 
                emp.currentStatus === 'checked_in' || emp.currentStatus === 'logged_in'
            ).length;
            
            document.getElementById('activeEmployees').textContent = activeEmployees;
            document.getElementById('offlineEmployees').textContent = allEmployees.length - activeEmployees;
            
            // Update percentage change
            const percentage = allEmployees.length > 0 ? 
                Math.round((uniqueEmployeesToday.size / allEmployees.length) * 100) : 0;
            
            document.getElementById('employeeChange').innerHTML = `
                <i class="fas fa-arrow-up"></i> ${percentage}%
            `;
            
            // Update widget data
            updateWidgetData();
        }

        // Update widget data
        function updateWidgetData() {
            const today = new Date().toISOString().split('T')[0];
            
            // Top employee
            const employeeStats = {};
            allEmployees.forEach(emp => {
                const employeeRecords = allRecords.filter(r => 
                    r.employeeId === emp.id && r.date === today && r.type === 'checkin'
                );
                employeeStats[emp.id] = {
                    name: emp.name,
                    checkins: employeeRecords.length
                };
            });
            
            let topEmployee = null;
            let maxCheckins = 0;
            
            Object.keys(employeeStats).forEach(empId => {
                if (employeeStats[empId].checkins > maxCheckins) {
                    maxCheckins = employeeStats[empId].checkins;
                    topEmployee = employeeStats[empId];
                }
            });
            
            if (topEmployee) {
                document.getElementById('topEmployee').textContent = topEmployee.name;
                document.getElementById('topEmployeeHours').textContent = 
                    `${maxCheckins} Ù…Ø±Ø§Øª Ø­Ø¶ÙˆØ±`;
            }
            
            // Last check-in
            const lastCheckIn = allRecords.find(r => r.type === 'checkin');
            if (lastCheckIn) {
                const time = new Date(lastCheckIn.timestamp).toLocaleTimeString('ar-EG', {
                    hour: '2-digit',
                    minute: '2-digit'
                });
                document.getElementById('lastCheckInTime').textContent = time;
                document.getElementById('lastCheckInEmployee').textContent = lastCheckIn.employeeName;
            }
            
            // Top department
            const departmentStats = {};
            allEmployees.forEach(emp => {
                if (!departmentStats[emp.department]) {
                    departmentStats[emp.department] = 0;
                }
                departmentStats[emp.department]++;
            });
            
            let topDepartment = null;
            let maxEmployees = 0;
            
            Object.keys(departmentStats).forEach(dept => {
                if (departmentStats[dept] > maxEmployees) {
                    maxEmployees = departmentStats[dept];
                    topDepartment = dept;
                }
            });
            
            if (topDepartment) {
                document.getElementById('topDepartment').textContent = topDepartment;
                document.getElementById('topDepartmentCount').textContent = `${maxEmployees} Ù…ÙˆØ¸ÙÙŠÙ†`;
            }
            
            // Total work hours today
            let totalMinutesToday = 0;
            const todayRecords = allRecords.filter(r => r.date === today);
            
            for (let i = 0; i < todayRecords.length; i++) {
                if (todayRecords[i].type === 'checkin' && 
                    i + 1 < todayRecords.length && 
                    todayRecords[i + 1].type === 'checkout') {
                    
                    const checkinTime = new Date(todayRecords[i].timestamp);
                    const checkoutTime = new Date(todayRecords[i + 1].timestamp);
                    totalMinutesToday += (checkoutTime - checkinTime) / 1000 / 60;
                }
            }
            
            const totalHours = Math.floor(totalMinutesToday / 60);
            const totalMins = Math.floor(totalMinutesToday % 60);
            document.getElementById('totalWorkHours').textContent = 
                `${totalHours}:${totalMins.toString().padStart(2, '0')}`;
        }

        // Update employee list
        function updateEmployeeList() {
            const container = document.getElementById('employeeList');
            
            if (allEmployees.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon"><i class="fas fa-users"></i></div>
                        <p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…ÙˆØ¸ÙÙŠÙ†</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            allEmployees.forEach(emp => {
                const status = emp.currentStatus || 'offline';
                const statusClass = status === 'checked_in' ? 'status-checked-in' : 
                                  status === 'logged_in' ? 'status-online' : 
                                  status === 'checked_out' ? 'status-checked-out' : 'status-offline';
                
                const statusText = status === 'checked_in' ? 'Ø¯Ø§Ø®Ù„ Ø§Ù„Ø¹Ù…Ù„' :
                                 status === 'logged_in' ? 'Ù…ØªØµÙ„' :
                                 status === 'checked_out' ? 'Ø®Ø§Ø±Ø¬ Ø§Ù„Ø¹Ù…Ù„' : 'ØºÙŠØ± Ù…ØªØµÙ„';
                
                // Get today's records for this employee
                const today = new Date().toISOString().split('T')[0];
                const todayRecords = allRecords.filter(r => 
                    r.employeeId === emp.id && r.date === today
                );
                
                let workMinutes = 0;
                for (let i = 0; i < todayRecords.length; i++) {
                    if (todayRecords[i].type === 'checkin' && 
                        i + 1 < todayRecords.length && 
                        todayRecords[i + 1].type === 'checkout') {
                        
                        const checkinTime = new Date(todayRecords[i].timestamp);
                        const checkoutTime = new Date(todayRecords[i + 1].timestamp);
                        workMinutes += (checkoutTime - checkinTime) / 1000 / 60;
                    }
                }
                
                const workHours = Math.floor(workMinutes / 60);
                const workMins = Math.floor(workMinutes % 60);
                
                html += `
                    <div class="employee-item" onclick="showEmployeeDetails('${emp.id}')">
                        <div class="employee-avatar">${emp.name.charAt(0)}</div>
                        <div class="employee-info">
                            <div class="employee-name">${emp.name}</div>
                            <div class="employee-details">
                                ${emp.department} â€¢ ${emp.id}
                            </div>
                            <div class="employee-details" style="margin-top: 5px;">
                                <i class="fas fa-clock"></i> 
                                ${workHours}:${workMins.toString().padStart(2, '0')} Ø³Ø§Ø¹Ø© Ø§Ù„ÙŠÙˆÙ…
                            </div>
                        </div>
                        <div class="employee-status">
                            <span class="badge badge-primary">${statusText}</span>
                            <span class="status-dot ${statusClass}"></span>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        // Update employee filter
        function updateEmployeeFilter() {
            const select = document.getElementById('filterEmployee');
            let html = '<option value="">Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</option>';
            
            allEmployees.forEach(emp => {
                html += `<option value="${emp.id}">${emp.name} (${emp.department})</option>`;
            });
            
            select.innerHTML = html;
        }

        // Update records table
        function updateRecordsTable() {
            filterRecordsByTab();
            renderRecordsTable();
        }

        // Filter records by tab
        function filterRecordsByTab() {
            const today = new Date().toISOString().split('T')[0];
            const weekAgo = new Date();
            weekAgo.setDate(weekAgo.getDate() - 7);
            const weekAgoStr = weekAgo.toISOString().split('T')[0];
            
            const monthAgo = new Date();
            monthAgo.setDate(monthAgo.getDate() - 30);
            const monthAgoStr = monthAgo.toISOString().split('T')[0];
            
            switch(currentTab) {
                case 'today':
                    filteredRecords = allRecords.filter(r => r.date === today);
                    break;
                case 'week':
                    filteredRecords = allRecords.filter(r => r.date >= weekAgoStr);
                    break;
                case 'month':
                    filteredRecords = allRecords.filter(r => r.date >= monthAgoStr);
                    break;
                case 'all':
                    filteredRecords = [...allRecords];
                    break;
            }
            
            // Apply additional filters
            applyAdditionalFilters();
        }

        // Apply additional filters
        function applyAdditionalFilters() {
            const employeeFilter = document.getElementById('filterEmployee').value;
            const dateFilter = document.getElementById('filterDate').value;
            const typeFilter = document.getElementById('filterType').value;
            const searchFilter = document.getElementById('searchRecords').value.toLowerCase();
            
            let filtered = [...filteredRecords];
            
            if (employeeFilter) {
                filtered = filtered.filter(r => r.employeeId === employeeFilter);
            }
            
            if (dateFilter) {
                filtered = filtered.filter(r => r.date === dateFilter);
            }
            
            if (typeFilter) {
                filtered = filtered.filter(r => r.type === typeFilter);
            }
            
            if (searchFilter) {
                filtered = filtered.filter(r => 
                    r.employeeName.toLowerCase().includes(searchFilter) ||
                    r.employeeId.toLowerCase().includes(searchFilter) ||
                    r.department.toLowerCase().includes(searchFilter)
                );
            }
            
            filteredRecords = filtered;
        }

        // Render records table
        function renderRecordsTable() {
            const tbody = document.getElementById('recordsBody');
            
            if (filteredRecords.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="9" style="text-align: center; padding: 40px;">
                            <div class="empty-state">
                                <div class="empty-state-icon"><i class="fas fa-clipboard-list"></i></div>
                                <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª</p>
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }
            
            let html = '';
            filteredRecords.forEach((record, index) => {
                const typeBadge = record.type === 'checkin' ? 
                    '<span class="badge badge-success">Ø­Ø¶ÙˆØ±</span>' : 
                    '<span class="badge badge-danger">Ø§Ù†ØµØ±Ø§Ù</span>';
                
                const locationBadge = record.location.isValid ? 
                    '<span class="badge badge-success">Ø¯Ø§Ø®Ù„ Ø§Ù„Ù†Ø·Ø§Ù‚</span>' : 
                    '<span class="badge badge-danger">Ø®Ø§Ø±Ø¬ Ø§Ù„Ù†Ø·Ø§Ù‚</span>';
                
                const time = new Date(record.timestamp).toLocaleTimeString('ar-EG', {
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                html += `
                    <tr>
                        <td>${index + 1}</td>
                        <td>
                            <strong>${record.employeeName}</strong><br>
                            <small style="color: var(--gray);">${record.employeeId}</small>
                        </td>
                        <td>${record.department}</td>
                        <td>${typeBadge}</td>
                        <td>${record.date}</td>
                        <td>${time}</td>
                        <td>${locationBadge}</td>
                        <td>${record.location.distance} Ù…ØªØ±</td>
                        <td>
                            <div class="table-actions">
                                <button class="action-btn view" onclick="showRecordDetails('${record.id}')">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="action-btn delete" onclick="deleteRecord('${record.id}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            tbody.innerHTML = html;
        }

        // Update live map with employee locations
        function updateLiveMap() {
            if (!liveMap) return;
            
            // Clear existing markers
            employeeMarkers.forEach(marker => marker.remove());
            employeeMarkers = [];
            
            // Get latest check-in for each employee
            const employeeLatestLocation = {};
            
            allRecords.forEach(record => {
                if (record.type === 'checkin') {
                    if (!employeeLatestLocation[record.employeeId] || 
                        new Date(record.timestamp) > new Date(employeeLatestLocation[record.employeeId].timestamp)) {
                        employeeLatestLocation[record.employeeId] = record;
                    }
                }
            });
            
            // Add markers for employees with recent check-ins
            Object.values(employeeLatestLocation).forEach(record => {
                if (!record.location || !record.location.latitude || !record.location.longitude) {
                    return;
                }
                
                const employee = allEmployees.find(emp => emp.id === record.employeeId);
                if (!employee) return;
                
                const isActive = employee.currentStatus === 'checked_in';
                const color = isActive ? '#10b981' : '#ef4444';
                const status = isActive ? 'Ø¯Ø§Ø®Ù„ Ø§Ù„Ø¹Ù…Ù„' : 'Ø®Ø§Ø±Ø¬ Ø§Ù„Ø¹Ù…Ù„';
                
                // Create custom marker element
                const el = document.createElement('div');
                el.className = 'employee-marker';
                el.innerHTML = `
                    <div style="
                        width: 40px;
                        height: 40px;
                        background: ${color};
                        border-radius: 50%;
                        border: 3px solid white;
                        box-shadow: 0 0 15px rgba(0,0,0,0.3);
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        color: white;
                        font-size: 16px;
                        cursor: pointer;
                        position: relative;
                    ">
                        <i class="fas fa-user"></i>
                        <div style="
                            position: absolute;
                            bottom: -5px;
                            right: -5px;
                            width: 15px;
                            height: 15px;
                            background: ${color};
                            border-radius: 50%;
                            border: 2px solid white;
                        "></div>
                    </div>
                `;
                
                const marker = new mapboxgl.Marker({
                    element: el,
                    anchor: 'center'
                })
                .setLngLat([record.location.longitude, record.location.latitude])
                .setPopup(new mapboxgl.Popup().setHTML(`
                    <div style="padding: 15px; min-width: 250px;">
                        <h4 style="margin: 0 0 10px 0; color: ${color};">
                            <i class="fas fa-user"></i> ${employee.name}
                        </h4>
                        <p style="margin: 5px 0; font-size: 13px;">
                            <strong>Ø§Ù„Ø­Ø§Ù„Ø©:</strong> ${status}
                        </p>
                        <p style="margin: 5px 0; font-size: 13px;">
                            <strong>Ø§Ù„Ù…Ø³Ø§ÙØ©:</strong> ${record.location.distance} Ù…ØªØ±
                        </p>
                        <p style="margin: 5px 0; font-size: 13px;">
                            <strong>Ø§Ù„ÙˆÙ‚Øª:</strong> ${new Date(record.timestamp).toLocaleTimeString('ar-EG')}
                        </p>
                        <p style="margin: 5px 0; font-size: 12px; color: var(--gray);">
                            ${record.location.latitude.toFixed(6)}, ${record.location.longitude.toFixed(6)}
                        </p>
                    </div>
                `))
                .addTo(liveMap);
                
                employeeMarkers.push(marker);
            });
        }

        // Initialize charts
        function initCharts() {
            // Attendance Chart
            const attendanceCtx = document.getElementById('attendanceChart').getContext('2d');
            attendanceChart = new Chart(attendanceCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Ø­Ø§Ø¶Ø±ÙˆÙ†', 'ØºØ§Ø¦Ø¨ÙˆÙ†', 'Ù…ØªØ£Ø®Ø±ÙˆÙ†'],
                    datasets: [{
                        data: [0, 0, 0],
                        backgroundColor: [
                            '#10b981',
                            '#ef4444',
                            '#f59e0b'
                        ],
                        borderWidth: 2,
                        borderColor: '#ffffff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            rtl: true,
                            labels: {
                                font: {
                                    family: 'Cairo, sans-serif'
                                },
                                padding: 20
                            }
                        },
                        tooltip: {
                            rtl: true,
                            bodyFont: {
                                family: 'Cairo, sans-serif'
                            }
                        }
                    }
                }
            });

            // Hours Chart
            const hoursCtx = document.getElementById('hoursChart').getContext('2d');
            hoursChart = new Chart(hoursCtx, {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„',
                        data: [],
                        backgroundColor: '#3b82f6',
                        borderColor: '#1d4ed8',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            rtl: true,
                            bodyFont: {
                                family: 'Cairo, sans-serif'
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Ø³Ø§Ø¹Ø§Øª',
                                font: {
                                    family: 'Cairo, sans-serif'
                                }
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Ø§Ù„Ø£ÙŠØ§Ù…',
                                font: {
                                    family: 'Cairo, sans-serif'
                                }
                            }
                        }
                    }
                }
            });

            updateCharts();
        }

        // Update charts with data
        function updateCharts() {
            if (!attendanceChart || !hoursChart) return;

            const today = new Date().toISOString().split('T')[0];
            const presentCount = new Set(allRecords
                .filter(r => r.date === today && r.type === 'checkin')
                .map(r => r.employeeId)
            ).size;

            const absentCount = Math.max(0, allEmployees.length - presentCount);
            
            // Update attendance chart
            attendanceChart.data.datasets[0].data = [presentCount, absentCount, 0];
            attendanceChart.update();

            // Update hours chart (last 7 days)
            const last7Days = [];
            const dailyHours = [];
            
            for (let i = 6; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                const dateStr = date.toISOString().split('T')[0];
                
                const dayRecords = allRecords.filter(r => r.date === dateStr);
                let dayMinutes = 0;
                
                for (let j = 0; j < dayRecords.length; j++) {
                    if (dayRecords[j].type === 'checkin' && 
                        j + 1 < dayRecords.length && 
                        dayRecords[j + 1].type === 'checkout') {
                        
                        const checkinTime = new Date(dayRecords[j].timestamp);
                        const checkoutTime = new Date(dayRecords[j + 1].timestamp);
                        dayMinutes += (checkoutTime - checkinTime) / 1000 / 60;
                    }
                }
                
                const dayHours = (dayMinutes / 60).toFixed(1);
                last7Days.push(formatArabicDate(date));
                dailyHours.push(parseFloat(dayHours));
            }
            
            hoursChart.data.labels = last7Days;
            hoursChart.data.datasets[0].data = dailyHours;
            hoursChart.update();
        }

        // Format Arabic date
        function formatArabicDate(date) {
            const day = date.getDate();
            const month = date.getMonth() + 1;
            return `${day}/${month}`;
        }

        // Update date and time
        function updateDateTime() {
            const now = new Date();
            
            // Format date in Arabic
            const options = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            };
            const dateString = now.toLocaleDateString('ar-EG', options);
            
            // Format time
            const timeString = now.toLocaleTimeString('ar-EG');
            
            // Update elements
            const dateElement = document.getElementById('currentDate');
            const timeElement = document.getElementById('currentTime');
            
            if (dateElement) dateElement.textContent = dateString;
            if (timeElement) timeElement.textContent = timeString;
        }

        // Start real-time updates
        function startRealtimeUpdates() {
            // Refresh data every 30 seconds
            setInterval(async () => {
                await loadAllData();
            }, 30000);
        }

        // Event Handlers
        window.switchTab = function(tab) {
            currentTab = tab;
            
            // Update tab buttons
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            
            updateRecordsTable();
        };

        window.filterRecords = function() {
            updateRecordsTable();
        };

        window.searchRecords = function() {
            updateRecordsTable();
        };

        window.searchEmployees = function() {
            const searchTerm = document.getElementById('searchEmployees').value.toLowerCase();
            const container = document.getElementById('employeeList');
            
            if (!searchTerm) {
                updateEmployeeList();
                return;
            }
            
            const filteredEmployees = allEmployees.filter(emp =>
                emp.name.toLowerCase().includes(searchTerm) ||
                emp.id.toLowerCase().includes(searchTerm) ||
                emp.department.toLowerCase().includes(searchTerm) ||
                (emp.phone && emp.phone.includes(searchTerm))
            );
            
            if (filteredEmployees.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon"><i class="fas fa-search"></i></div>
                        <p>Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…ÙˆØ¸ÙÙŠÙ†</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            filteredEmployees.forEach(emp => {
                const status = emp.currentStatus || 'offline';
                const statusClass = status === 'checked_in' ? 'status-checked-in' : 
                                  status === 'logged_in' ? 'status-online' : 
                                  status === 'checked_out' ? 'status-checked-out' : 'status-offline';
                
                const statusText = status === 'checked_in' ? 'Ø¯Ø§Ø®Ù„ Ø§Ù„Ø¹Ù…Ù„' :
                                 status === 'logged_in' ? 'Ù…ØªØµÙ„' :
                                 status === 'checked_out' ? 'Ø®Ø§Ø±Ø¬ Ø§Ù„Ø¹Ù…Ù„' : 'ØºÙŠØ± Ù…ØªØµÙ„';
                
                html += `
                    <div class="employee-item" onclick="showEmployeeDetails('${emp.id}')">
                        <div class="employee-avatar">${emp.name.charAt(0)}</div>
                        <div class="employee-info">
                            <div class="employee-name">${emp.name}</div>
                            <div class="employee-details">${emp.department} â€¢ ${emp.id}</div>
                        </div>
                        <div class="employee-status">
                            <span class="badge badge-primary">${statusText}</span>
                            <span class="status-dot ${statusClass}"></span>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        };

        window.refreshData = async function() {
            showToast('Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...', 'info');
            await loadAllData();
            showToast('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­', 'success');
        };

        window.showAddEmployeeModal = function() {
            document.getElementById('addEmployeeModal').classList.add('show');
            document.getElementById('addEmployeeForm').reset();
        };

        window.closeModal = function(modalId) {
            document.getElementById(modalId).classList.remove('show');
        };

        // Add employee form submission
        document.getElementById('addEmployeeForm').addEventListener('submit', async function(event) {
            event.preventDefault();
            
            const employeeId = document.getElementById('newEmployeeId').value.trim();
            const employeeName = document.getElementById('newEmployeeName').value.trim();
            const department = document.getElementById('newEmployeeDepartment').value.trim();
            const shift = document.getElementById('newEmployeeShift').value;
            const phone = document.getElementById('newEmployeePhone').value.trim();
            const email = document.getElementById('newEmployeeEmail').value.trim();
            
            if (!employeeId || !employeeName || !department || !shift) {
                showToast('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©', 'error');
                return;
            }
            
            // Check if employee already exists
            if (allEmployees.some(emp => emp.id === employeeId)) {
                showToast('Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¸Ù Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„', 'error');
                return;
            }
            
            try {
                const employeeData = {
                    id: employeeId,
                    name: employeeName,
                    department: department,
                    shift: shift,
                    phone: phone || '',
                    email: email || '',
                    hireDate: new Date().toISOString().split('T')[0],
                    currentStatus: 'offline',
                    createdAt: serverTimestamp()
                };
                
                await set(ref(database, `employees/${employeeId}`), employeeData);
                
                showToast('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙˆØ¸Ù Ø¨Ù†Ø¬Ø§Ø­', 'success');
                closeModal('addEmployeeModal');
                
                // Refresh data
                await loadAllData();
                
            } catch (error) {
                console.error('Error adding employee:', error);
                showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙˆØ¸Ù', 'error');
            }
        });

        window.showEmployeeDetails = async function(employeeId) {
            const employee = allEmployees.find(emp => emp.id === employeeId);
            if (!employee) return;
            
            // Get employee records
            const employeeRecords = allRecords.filter(r => r.employeeId === employeeId);
            const today = new Date().toISOString().split('T')[0];
            const todayRecords = employeeRecords.filter(r => r.date === today);
            
            let totalMinutes = 0;
            for (let i = 0; i < todayRecords.length; i++) {
                if (todayRecords[i].type === 'checkin' && 
                    i + 1 < todayRecords.length && 
                    todayRecords[i + 1].type === 'checkout') {
                    
                    const checkinTime = new Date(todayRecords[i].timestamp);
                    const checkoutTime = new Date(todayRecords[i + 1].timestamp);
                    totalMinutes += (checkoutTime - checkinTime) / 1000 / 60;
                }
            }
            
            const totalHours = Math.floor(totalMinutes / 60);
            const totalMins = Math.floor(totalMinutes % 60);
            
            // Calculate attendance rate (last 30 days)
            const thirtyDaysAgo = new Date();
            thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
            const recentRecords = employeeRecords.filter(r => 
                new Date(r.date) >= thirtyDaysAgo && r.type === 'checkin'
            );
            
            const uniqueDays = new Set(recentRecords.map(r => r.date)).size;
            const attendanceRate = Math.round((uniqueDays / 30) * 100);
            
            document.getElementById('employeeModalTitle').textContent = employee.name;
            
            document.getElementById('employeeDetailsContent').innerHTML = `
                <div style="margin-bottom: 25px;">
                    <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 20px;">
                        <div style="
                            width: 80px;
                            height: 80px;
                            background: linear-gradient(135deg, var(--primary), var(--secondary));
                            border-radius: 50%;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            color: white;
                            font-size: 32px;
                            font-weight: bold;
                        ">
                            ${employee.name.charAt(0)}
                        </div>
                        <div>
                            <h4 style="margin: 0 0 5px 0; color: var(--dark);">${employee.name}</h4>
                            <p style="margin: 0; color: var(--gray);">${employee.department}</p>
                            <p style="margin: 5px 0 0 0; color: var(--gray); font-size: 14px;">
                                <i class="fas fa-id-card"></i> ${employee.id}
                            </p>
                        </div>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 25px;">
                    <div style="background: var(--light); padding: 15px; border-radius: var(--radius);">
                        <div style="font-size: 12px; color: var(--gray); margin-bottom: 5px;">Ø§Ù„ÙˆØ±Ø¯ÙŠØ©</div>
                        <div style="font-weight: 600; color: var(--dark);">
                            ${getShiftName(employee.shift)}
                        </div>
                    </div>
                    <div style="background: var(--light); padding: 15px; border-radius: var(--radius);">
                        <div style="font-size: 12px; color: var(--gray); margin-bottom: 5px;">Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø­Ø¶ÙˆØ±</div>
                        <div style="font-weight: 600; color: var(--dark);">
                            ${attendanceRate}%
                        </div>
                    </div>
                    <div style="background: var(--light); padding: 15px; border-radius: var(--radius);">
                        <div style="font-size: 12px; color: var(--gray); margin-bottom: 5px;">Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„ÙŠÙˆÙ…</div>
                        <div style="font-weight: 600; color: var(--dark);">
                            ${totalHours}:${totalMins.toString().padStart(2, '0')}
                        </div>
                    </div>
                    <div style="background: var(--light); padding: 15px; border-radius: var(--radius);">
                        <div style="font-size: 12px; color: var(--gray); margin-bottom: 5px;">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ø¬Ù„Ø§Øª</div>
                        <div style="font-weight: 600; color: var(--dark);">
                            ${employeeRecords.length}
                        </div>
                    </div>
                </div>
                
                ${employee.phone ? `
                    <div style="margin-bottom: 15px;">
                        <div style="font-size: 12px; color: var(--gray); margin-bottom: 5px;">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</div>
                        <div style="font-weight: 600; color: var(--dark);">
                            <i class="fas fa-phone"></i> ${employee.phone}
                        </div>
                    </div>
                ` : ''}
                
                ${employee.email ? `
                    <div style="margin-bottom: 25px;">
                        <div style="font-size: 12px; color: var(--gray); margin-bottom: 5px;">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</div>
                        <div style="font-weight: 600; color: var(--dark);">
                            <i class="fas fa-envelope"></i> ${employee.email}
                        </div>
                    </div>
                ` : ''}
                
                <div style="margin-bottom: 20px;">
                    <div style="font-size: 12px; color: var(--gray); margin-bottom: 10px;">Ø¢Ø®Ø± 5 Ø³Ø¬Ù„Ø§Øª</div>
                    <div style="max-height: 200px; overflow-y: auto;">
                        ${employeeRecords.slice(0, 5).map(record => `
                            <div style="
                                background: white;
                                padding: 10px;
                                border-radius: var(--radius);
                                margin-bottom: 8px;
                                border-right: 3px solid ${record.type === 'checkin' ? '#10b981' : '#ef4444'};
                                font-size: 13px;
                            ">
                                <div style="display: flex; justify-content: space-between;">
                                    <span style="font-weight: 600; color: ${record.type === 'checkin' ? '#10b981' : '#ef4444'};">
                                        ${record.type === 'checkin' ? 'Ø­Ø¶ÙˆØ±' : 'Ø§Ù†ØµØ±Ø§Ù'}
                                    </span>
                                    <span style="color: var(--gray);">
                                        ${record.date} ${new Date(record.timestamp).toLocaleTimeString('ar-EG', {hour: '2-digit', minute: '2-digit'})}
                                    </span>
                                </div>
                                <div style="color: var(--dark-light); margin-top: 3px;">
                                    ${record.location.distance} Ù…ØªØ± â€¢ 
                                    ${record.location.isValid ? 'Ø¯Ø§Ø®Ù„ Ø§Ù„Ù†Ø·Ø§Ù‚' : 'Ø®Ø§Ø±Ø¬ Ø§Ù„Ù†Ø·Ø§Ù‚'}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            
            document.getElementById('deleteEmployeeBtn').onclick = () => deleteEmployee(employeeId);
            document.getElementById('employeeDetailsModal').classList.add('show');
        };

        window.showRecordDetails = async function(recordId) {
            const record = allRecords.find(r => r.id === recordId);
            if (!record) return;
            
            const employee = allEmployees.find(emp => emp.id === record.employeeId);
            
            document.getElementById('recordDetailsContent').innerHTML = `
                <div style="margin-bottom: 25px;">
                    <h4 style="margin: 0 0 15px 0; color: var(--dark);">
                        <i class="fas fa-info-circle"></i> ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø³Ø¬Ù„
                    </h4>
                    
                    <div style="display: grid; gap: 12px;">
                        <div style="display: flex; justify-content: space-between;">
                            <span style="color: var(--gray);">Ø§Ù„Ù…ÙˆØ¸Ù:</span>
                            <span style="font-weight: 600; color: var(--dark);">${record.employeeName}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span style="color: var(--gray);">Ø§Ù„Ù‚Ø³Ù…:</span>
                            <span style="font-weight: 600; color: var(--dark);">${record.department}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span style="color: var(--gray);">Ø§Ù„Ù†ÙˆØ¹:</span>
                            <span style="font-weight: 600; color: ${record.type === 'checkin' ? '#10b981' : '#ef4444'};">
                                ${record.type === 'checkin' ? 'Ø­Ø¶ÙˆØ±' : 'Ø§Ù†ØµØ±Ø§Ù'}
                            </span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span style="color: var(--gray);">Ø§Ù„ØªØ§Ø±ÙŠØ®:</span>
                            <span style="font-weight: 600; color: var(--dark);">${record.date}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span style="color: var(--gray);">Ø§Ù„ÙˆÙ‚Øª:</span>
                            <span style="font-weight: 600; color: var(--dark);">${record.time}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span style="color: var(--gray);">Ø§Ù„Ù…Ø³Ø§ÙØ©:</span>
                            <span style="font-weight: 600; color: var(--dark);">${record.location.distance} Ù…ØªØ±</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span style="color: var(--gray);">Ø­Ø§Ù„Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¹:</span>
                            <span style="font-weight: 600; color: ${record.location.isValid ? '#10b981' : '#ef4444'};">
                                ${record.location.isValid ? 'Ø¯Ø§Ø®Ù„ Ø§Ù„Ù†Ø·Ø§Ù‚' : 'Ø®Ø§Ø±Ø¬ Ø§Ù„Ù†Ø·Ø§Ù‚'}
                            </span>
                        </div>
                        ${record.location.address ? `
                            <div style="display: flex; justify-content: space-between;">
                                <span style="color: var(--gray);">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</span>
                                <span style="font-weight: 600; color: var(--dark); font-size: 12px; text-align: left;">
                                    ${record.location.address}
                                </span>
                            </div>
                        ` : ''}
                        <div style="display: flex; justify-content: space-between;">
                            <span style="color: var(--gray);">Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª:</span>
                            <span style="font-weight: 600; color: var(--dark); font-size: 12px;">
                                ${record.location.latitude.toFixed(6)}, ${record.location.longitude.toFixed(6)}
                            </span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span style="color: var(--gray);">Ø¯Ù‚Ø© GPS:</span>
                            <span style="font-weight: 600; color: var(--dark);">
                                ${record.location.accuracy ? Math.round(record.location.accuracy) + ' Ù…ØªØ±' : 'ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©'}
                            </span>
                        </div>
                        ${employee && employee.shift ? `
                            <div style="display: flex; justify-content: space-between;">
                                <span style="color: var(--gray);">Ø§Ù„ÙˆØ±Ø¯ÙŠØ©:</span>
                                <span style="font-weight: 600; color: var(--dark);">
                                    ${getShiftName(employee.shift)}
                                </span>
                            </div>
                        ` : ''}
                    </div>
                </div>
                
                <div style="background: var(--light); padding: 15px; border-radius: var(--radius);">
                    <div style="font-size: 12px; color: var(--gray); margin-bottom: 8px;">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¬Ù‡Ø§Ø²</div>
                    ${record.deviceInfo ? `
                        <div style="font-size: 12px; color: var(--dark-light);">
                            ${record.deviceInfo.userAgent ? `
                                <div style="margin-bottom: 5px;">
                                    <i class="fas fa-desktop"></i> 
                                    ${record.deviceInfo.userAgent.split('(')[1].split(')')[0]}
                                </div>
                            ` : ''}
                            ${record.deviceInfo.screenSize ? `
                                <div>
                                    <i class="fas fa-expand"></i> Ø¯Ù‚Ø© Ø§Ù„Ø´Ø§Ø´Ø©: ${record.deviceInfo.screenSize}
                                </div>
                            ` : ''}
                        </div>
                    ` : 'ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©'}
                </div>
            `;
            
            document.getElementById('recordDetailsModal').classList.add('show');
        };

        window.deleteRecord = async function(recordId) {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø³Ø¬Ù„ØŸ')) return;
            
            try {
                await remove(ref(database, `attendance/${recordId}`));
                showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø³Ø¬Ù„ Ø¨Ù†Ø¬Ø§Ø­', 'success');
                await loadAllData();
            } catch (error) {
                console.error('Error deleting record:', error);
                showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­Ø°Ù Ø§Ù„Ø³Ø¬Ù„', 'error');
            }
        };

        window.deleteEmployee = async function(employeeId) {
            if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆØ¸ÙØŸ Ø³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø³Ø¬Ù„Ø§ØªÙ‡ Ø£ÙŠØ¶Ø§Ù‹.')) return;
            
            try {
                // Delete employee
                await remove(ref(database, `employees/${employeeId}`));
                
                // Delete employee's records
                const employeeRecords = allRecords.filter(r => r.employeeId === employeeId);
                for (const record of employeeRecords) {
                    await remove(ref(database, `attendance/${record.id}`));
                }
                
                showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…ÙˆØ¸Ù ÙˆØ¬Ù…ÙŠØ¹ Ø³Ø¬Ù„Ø§ØªÙ‡ Ø¨Ù†Ø¬Ø§Ø­', 'success');
                closeModal('employeeDetailsModal');
                await loadAllData();
            } catch (error) {
                console.error('Error deleting employee:', error);
                showToast('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­Ø°Ù Ø§Ù„Ù…ÙˆØ¸Ù', 'error');
            }
        };

        window.exportToExcel = function() {
            // Create CSV content
            let csv = '\ufeff';
            
            // Add headers
            csv += 'Ø§Ù„Ø±Ù‚Ù…,Ø§Ù„Ù…ÙˆØ¸Ù,Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¸Ù,Ø§Ù„Ù‚Ø³Ù…,Ø§Ù„Ù†ÙˆØ¹,Ø§Ù„ØªØ§Ø±ÙŠØ®,Ø§Ù„ÙˆÙ‚Øª,Ø§Ù„Ù…Ø³Ø§ÙØ©,Ø­Ø§Ù„Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¹,Ø§Ù„Ø¹Ù†ÙˆØ§Ù†\n';
            
            // Add data
            filteredRecords.forEach((record, index) => {
                const type = record.type === 'checkin' ? 'Ø­Ø¶ÙˆØ±' : 'Ø§Ù†ØµØ±Ø§Ù';
                const locationStatus = record.location.isValid ? 'Ø¯Ø§Ø®Ù„ Ø§Ù„Ù†Ø·Ø§Ù‚' : 'Ø®Ø§Ø±Ø¬ Ø§Ù„Ù†Ø·Ø§Ù‚';
                const address = record.location.address || 'ØºÙŠØ± Ù…ØªÙˆÙØ±';
                
                csv += `${index + 1},${record.employeeName},${record.employeeId},${record.department},`;
                csv += `${type},${record.date},${record.time},${record.location.distance},`;
                csv += `${locationStatus},"${address}"\n`;
            });
            
            // Create download link
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `attendance_report_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
            
            showToast('ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­', 'success');
        };

        window.exportToPDF = function() {
            showToast('Ø®Ø§ØµÙŠØ© PDF Ù‚Ø±ÙŠØ¨Ø§Ù‹', 'info');
        };

        window.exportToCSV = function() {
            exportToExcel(); // Same as Excel for now
        };

        window.printRecords = function() {
            window.print();
        };

        window.showAllRecords = function() {
            currentTab = 'all';
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab')[3].classList.add('active');
            updateRecordsTable();
        };

        window.logout = function() {
            if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…ØŸ')) {
                localStorage.removeItem('adminLoggedIn');
                location.reload();
            }
        };

        // Get shift name
        function getShiftName(shift) {
            const shifts = {
                morning: 'ØµØ¨Ø§Ø­ÙŠØ© (8:00 - 16:00)',
                evening: 'Ù…Ø³Ø§Ø¦ÙŠØ© (16:00 - 00:00)',
                night: 'Ù„ÙŠÙ„ÙŠØ© (00:00 - 8:00)',
                flexible: 'Ù…Ø±Ù†Ø©'
            };
            return shifts[shift] || shift;
        }

        // Show toast notification
        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            const toastIcon = document.getElementById('toastIcon');
            const toastTitle = document.getElementById('toastTitle');
            const toastMessage = document.getElementById('toastMessage');
            
            // Set icon based on type
            let icon = 'info-circle';
            if (type === 'success') icon = 'check-circle';
            if (type === 'error') icon = 'exclamation-circle';
            if (type === 'warning') icon = 'exclamation-triangle';
            
            toastIcon.innerHTML = `<i class="fas fa-${icon}"></i>`;
            toastTitle.textContent = type === 'success' ? 'Ù†Ø¬Ø§Ø­' : 
                                   type === 'error' ? 'Ø®Ø·Ø£' : 
                                   type === 'warning' ? 'ØªÙ†Ø¨ÙŠÙ‡' : 'Ù…Ø¹Ù„ÙˆÙ…Ø©';
            toastMessage.textContent = message;
            
            // Set class
            toast.className = `toast ${type}`;
            toast.classList.add('show');
            
            // Auto hide after 5 seconds
            setTimeout(() => {
                hideToast();
            }, 5000);
        }

        // Hide toast
        window.hideToast = function() {
            const toast = document.getElementById('toast');
            toast.classList.remove('show');
        };
    </script>
</body>
</html>
